function getActiveConfig(){let t=parseInt((new Date).getTime()/1e3);sendApiRequest("/promotion/queryTargetInfoList",{targetStatus:"PUBLISH",afterStartTime:t,beforeEndTime:t,targetType:"ACTIVITY",resourceType:"SUBSCRIBE_ACTIVITY"}).then(t=>{if(0==t.code){const e=getCurrentActivity(t.data);setCookie("subscript-First-Visit",e.resourceId,2),formatActiveData(e),subscribeObj.activityId=e.resourceId,setCookie("subscript-plug-close",0)}}).catch(t=>{console.log(t),reject(t)})}function getCurrentActivity(t){var e=t[0];const s=getCookie("subscript-First-Visit");if(s&&(result=t.find(t=>t.resourceId===s),result))return result;if(t.length>1){var i=[];for(let e=0;e<t.length;e++){const s=t[e];let a=-1;var r=reverseTransform(s.targetPluginDtoList),o=!1;r.urlViewArr.forEach(function(t){pathname.indexOf(t.url)>-1&&pathname.length==t.url.length&&(o=!0)}),(0==r.radioView||1==r.radioView&&o||2==r.radioView&&!o)&&(a=e),i.push({createTime:s.createTime,radioView:r.radioView,actIndex:a})}i.sort((t,e)=>parseInt(t.createTime)-parseInt(e.createTime));let e=i.find(t=>"1"===t.radioView&&-1!==t.actIndex);if(e||(e=i.find(t=>"0"===t.radioView)),e)return t[e.actIndex];console.error("没有符合条件的对象")}return e}function formatActiveData(t){turntable.targetId=t.targetId,lottery=[];var e=t.resourceObject.activityItemDtoList;_formActive=reverseTransform(t.targetPluginDtoList);for(let e=0;e<t.languageMessageDtoList.length;e++){let s=t.languageMessageDtoList[e];languageMessageDtoList[s.key]=s.value}for(var s=0;s<e.length;s++){let t=e[s];lottery.push({location:s,title:t.itemName,url:t.extend.prizeUrl,itemType:t.itemType,bgColor:_formActive.turntable_prize_arr[s].bg_color,bg2Color:_formActive.turntable_prize_arr[s].bg2_color,fontSize:_formActive.turntable_prize_arr[s].font_size,mfontSize:_formActive.turntable_prize_arr[s].m_font_size,fontColor:_formActive.turntable_prize_arr[s].font_color})}turntable.itemNum=lottery.length,$(subscriptPlug).find(".step-one .title").html(languageMessageDtoList.index_title).attr("title",languageMessageDtoList.index_title),$(subscriptPlug).find(".step-one .desc").html(languageMessageDtoList.index_sub_title).attr("title",languageMessageDtoList.index_sub_title),$(subscriptPlug).find(".slide-left .abs-prize-pictures img").attr("src",_formActive.turntable_cover_url),$(".teaser-app").find(".teaser-image").attr("src",_formActive.turntable_teaser_url),$(subscriptPlug).find(".slide-left .pointer img").attr("src",_formActive.turntable_logo_url);var i=`<p>${languageMessageDtoList.index_sub_desc.replace(/\n/g,"</p><p>")}</p>`;$(subscriptPlug).find(".step-one .info").html(i),languageMessageDtoList.participate_receive_text.trim()?$(subscriptPlug).find(".box-receive .text").text(languageMessageDtoList.participate_receive_text):$(subscriptPlug).find(".box-receive").hide();var r=`<p>${languageMessageDtoList.participate_desc.replace(/\n/g,"</p><p>")}</p>`;if($(subscriptPlug).find(".setp-two .box-marketing").html(r),$(subscriptPlug).find(".setp-two .spin-it").text(languageMessageDtoList.btn_title),$(subscriptPlug).find(".m-box-head .title").text(languageMessageDtoList.index_title),$(subscriptPlug).find(".m-box-head .desc").text(languageMessageDtoList.index_sub_title),$(subscriptPlug).find(".setp-two .title").html(languageMessageDtoList.participate_main_title).attr("title",languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".setp-two .desc").html(languageMessageDtoList.participate_sub_title).attr("title",languageMessageDtoList.participate_sub_title),$(subscriptPlug).find(".setp-two .j_user_email").attr("placeholder",languageMessageDtoList.participate_email),$(subscriptPlug).find(".setp-two .input-phone").attr("placeholder",languageMessageDtoList.participate_phone),$(subscriptPlug).find(".success-popup .title").text(languageMessageDtoList.winning_title),$(subscriptPlug).find(".success-popup .desc").text(languageMessageDtoList.winning_sub_title),$(subscriptPlug).find(".success-popup .expire").text(languageMessageDtoList.winning_code_title),_formActive.turntable_arrow_url&&$(subscriptPlug).find(".abs-prize-arrow img").attr("src",_formActive.turntable_arrow_url),$(subscriptPlug).find(".turntable-wrap").css({"border-color":_formActive.turntable_bg_color,"box-shadow":"0 0 5px "+_formActive.turntable_bg_color}),$(subscriptPlug).css({"--title-color":_formActive.turntable_font_color,"--turntable_font_color":_formActive.turntable_bg_color,"--turntable_btn_color":_formActive.turntable_btn_color,"--turntable_btnfont_color":_formActive.turntable_btnfont_color,"--success_font_color":_formActive.success_font_color,"--turntable_font_bg_color":_formActive.t_bg_font_color,"--turntable_bg_color":_formActive.t_bg_color}),turntable.lottery=lottery,turntable.init(),pageControl(_formActive),"1"==_formActive.is_mobile){let t="";for(s=0;s<phoneList.length;s++){let e=phoneList[s],i=` <li data-code="${e.mcode}" data-chosen="${e.code}">\n        ${e.key}\n        <span class="flag-icon" data-chosen="${e.code}">\n        </span>\n      </li>`;t+=i}$(".dropdown-menu").html(t),$(".box-phone").show()}else $(".box-phone").hide()}function pageControl(t){var e=!1;t.urlViewArr.forEach(function(t){pathname.indexOf(t.url)>-1&&pathname.length==t.url.length&&(e=!0)}),(0==t.radioView||1==t.radioView&&e||2==t.radioView&&!e)&&showSubscriptionPopup(t),"0"==t.teaser&&$(".teaser-app").fadeIn("slow")}function showSubscriptionPopup(t){let e="visitor-times"+turntable.targetId,s="visitor-day"+turntable.targetId;setTimeout(function(){if("0"==t.text_device||!isMobile()&&"1"==t.text_device||isMobile()&&"2"==t.text_device){let i=getCookie(e)?parseInt(getCookie(e))+1:1;"1"==t.viewObj&&parseInt(t.text_viewNum)>=i?(setCookie(e,i),commonGtmEvent("转盘展示次数","subscriptPlug",""),addShowSubscript()):"2"!=t.viewObj||Boolean(getCookie(s))||(setCookie(s,!0,t.text_viewDay,!0),addShowSubscript(),commonGtmEvent("转盘展示次数","subscriptPlug",""))}},1e3*Number(t.text_in_show))}function addShowSubscript(){eventList.forEach(t=>{window.addEventListener(t,showSubPopup)})}function showSubPopup(){$("#subscript-plug").show(),eventList.forEach(t=>{window.removeEventListener(t,showSubPopup)})}function reverseTransform(t){function e(t){const{name:s,type:i,value:r}=t;if("array"===i){let t=r.map(t=>{let e={};return t.value.forEach(t=>{e[t.name]=t.value}),e});return{name:s,value:t}}return"object"===i?r.reduce((t,s)=>{const i=e(s);return t[i.name]=i.value,t},{}):{name:s,value:r}}return t.map(t=>{const s=e(t),i={};return void 0!==s&&(i[s.name]=s.value),i}).reduce((t,e)=>Object.assign(t,e),{})}function sendApiRequest(t,e){e.siteCode="UK",t="https://api.ulike.com"+t,e.language=window.Shopify.locale;var s={url:t,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};return new Promise((t,e)=>{$.ajax(s).done(function(e){t(e)}).fail(function(t){console.error("Error during API call:",t),e(t)})})}function validatePhoneNumber(t){const e=/^(\+|00)?[\d\s-]{0,4}?[\s-]?(\(?\d+\)?[\s-]?){1,6}\d+$/;return e.test(t)}function validateEmail(t){const e=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;return e.test(t)}function updateSuccessDom(t){var e=t.benefitName;subscribeObj.userEmail=t.userEmail;let s=`<span class="info">${e}</span>`;$("#subscript-plug .success-popup .left-code").html(s),t.award_info?$(subscriptPlug).find(".box-codes .right-detail").html(t.award_info):$("#subscript-plug .success-popup .right-detail .text-code span").text(t.resourceId),$("#subscript-plug .success-popup .subscript-btn-add-cart").attr("code",t.resourceId),$("#subscript-plug .spin-popup").hide(),$("#subscript-plug .success-popup").show(),$(".teaser-image").attr("src","https://cdn.shopify.com/s/files/1/0656/9079/6273/files/Frame_457393925.svg?v=1715667081"),$(".teaser-app").show()}function addtoCartTag(t){var e=new FormData;e.append("email",t),e.append("blog","Spin-ATC"),e.append("lang","uk");var s={async:!0,crossDomain:!0,url:"https://api.myulike.com/api/user-by-wp",method:"POST",headers:{},processData:!1,contentType:!1,mimeType:"multipart/form-data",data:e};jQuery.ajax(s).done(function(t){console.log(t)})}var turntable={itemNum:6,targetId:0,turntable:$("#turntable"),bg:null,gift:null,pointer:null,lottery:[],isGoing:!1,init(){if(!this.lottery.length)throw $(this.pointer).hide(),new Error("请设置中奖结果数据");$(this.bg).width(),this.itemNum;var t="";switch(this.itemNum){case 2:t="polygon(-8% 50%, 100% 50%, 100%  -130%)";break;case 3:t="polygon(50% 50%,95% 16%,-330px -76%)";break;case 4:t="polygon(50% 50%,100% 0%,0% 0%)";break;case 5:t="polygon(50% 50%,100% 76%,100% 0%)";break;case 6:t="polygon(50% 50%,-20% -70%, 110% -50%)";break;case 7:t="polygon(30% 80%, 80% 10%, 10% 20%)";break;case 8:t="polygon(50% 50%, 100% 30%, 88% -48%)";break;case 9:t="polygon(50% 50%, 100% 23%, 100% -100%)"}$("#subscript-plug").css({"--var-clip-path":t});for(let t=0;t<this.itemNum;t++){let s=360/this.itemNum*t;var e=this.lottery[t].bgColor;this.lottery[t].bg2Color&&(e=`linear-gradient(to bottom, ${this.lottery[t].bgColor}, ${this.lottery[t].bg2Color})`),$("<li>").css({transform:`rotate(${s}deg)`,background:e}).appendTo(this.bg);let i=isMobile()?this.lottery[t].mfontSize:this.lottery[t].fontSize,r=$("<li>").addClass("active").css({transform:`rotate(${s}deg)`,color:this.lottery[t].fontColor,"font-size":i+"px"}),o="";this.lottery[t].url&&(o=`<img src="${this.lottery[t].url}" />`);let a=this.lottery[t].title,n=`<span class="sub-name">${a}</span>`;$(`<div class="prize-item">\n            ${o}\n            ${n}\n          </div>`).appendTo(r),$(this.gift).append(r)}},gameStart(t){if(this.isGoing)return;$(".turntable").removeClass("spin-start"),$("#turntable").css({transform:"",transition:""}),this.isGoing=!0;let e=this.lottery.find(e=>e.title==t.benefitName),s=(this.lottery.length-e.location)*(360/this.lottery.length),i=s+360*this.lottery.length*1.5,r=(s/360*this.lottery.length).toFixed(2)+1;setTimeout(function(){$("#turntable").css({transform:`rotate(${i}deg)`,transition:`transform ${r}s ease-out`})},10),setTimeout(()=>{this.isGoing=!1,t.award_info=_formActive.award_info,t.userEmail=subscribeObj.userEmail,updateSuccessDom(t),setCookie("subscript-success",!0,2,!0),setCookie("subscript-success-data",JSON.stringify(t),2,!0),setCookie("subscript-isSubscribe",!0,30,!0)},1600*r)}};let lottery=[];var activityId="";const subscribeObj={name:"",userEmail:"",phoneNumber:"",activityId:"",sourceCode:"",extend:{utm_source:""},isMarketing:!1};var _formActive={},pathname=window.location.origin+location.pathname;let languageMessageDtoList={};const subscriptPlug=$("#subscript-plug");$(function(){turntable.light=$("#turntable_light")[0],turntable.bg=$("#turntable_bg")[0],turntable.gift=$("#turntable_gift")[0];let t=getCookie("subscript-success-data");getCookie("subscript-success")&&""!=t?t&&updateSuccessDom(JSON.parse(t)):getActiveConfig(),$(document).on("click","#subscript-plug .btn-wrap",function(t){$("#subscript-plug .step-one").hide(),$("#subscript-plug .setp-two").show(),$(subscriptPlug).find(".m-box-head .title").text(languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".m-box-head .desc").text(languageMessageDtoList.participate_sub_title),commonGtmEvent("首页Spin按钮","subscriptPlug","")}),$(".dropdown-selected").click(function(){$(".dropdown-menu").toggle()}),$(document).on("click",".dropdown-menu li",function(){var t=$(this).data("code"),e=$(this).data("chosen");$(".dropdown-selected .country-code").text(t),$(".dropdown-selected .flag-icon").attr("data-chosen",e),$(".dropdown-menu").hide()}),$(document).on("click","#subscript-plug .spin-it",function(t){commonGtmEvent("参与页订阅按钮","subscriptPlug",""),$("#subscript-plug .msg").hide().find("span").text(""),$(this).prop("disabled",!0);const e=new URLSearchParams(window.location.search);let s=e.get("utm_source");if(subscribeObj.extend.utm_source=s,subscribeObj.userEmail=$("#subscript-plug  .j_user_email").val(),""==subscribeObj.userEmail)return $(this).prop("disabled",!1),$("#subscript-plug .msg").show().find("span").text(subscriptCopywriting.email_err),void $(subscriptPlug).find(".input-email").addClass("error");if(!validateEmail(subscribeObj.userEmail))return $(this).prop("disabled",!1),$("#subscript-plug .msg").show().find("span").text(languageMessageDtoList.participate_email_err),void $(subscriptPlug).find(".input-email").addClass("error");if(!subscribeObj.isMarketing&&""!=languageMessageDtoList.participate_receive_text.trim())return $("#subscript-plug .msg").show().find("span").text(subscriptCopywriting.privacy_policy_err),$(this).prop("disabled",!1),!1;if("1"==_formActive.is_mobile){let t=$(".box-phone .dropdown .country-code").text(),e=$("#subscript-plug  .input-phone").val();if(!validatePhoneNumber(e))return $(this).prop("disabled",!1),void $("#subscript-plug .msg").show().find("span").text(languageMessageDtoList.participate_phone_err);subscribeObj.phoneNumber=t+"-"+e}$(".abs-prize-pictures").hide(),sendApiRequest("/promotion/sendBenefit",subscribeObj).then(t=>{if(0==t.code){let e=t.data;turntable.gameStart(e)}else 99998==t.code?($("#subscript-plug .msg").show().find("span").text(languageMessageDtoList[t.message]),$(this).prop("disabled",!1)):($("#subscript-plug .msg").show().find("span").text(subscriptCopywriting.system_err),$(this).prop("disabled",!1))}).catch(t=>{$(this).prop("disabled",!1),reject(t)})}),$(document).on("click","#subscript-plug .setp-two .box-receive",function(t){$("#policy-checkbox").prop("checked")?(subscribeObj.isMarketing=!1,$("#policy-checkbox").prop("checked",!1)):(subscribeObj.isMarketing=!0,$("#policy-checkbox").prop("checked",!0))}),$(document).on("click","#subscript-plug #turntable_pointer",function(t){$("#subscript-plug .setp-two").is(":visible")?($("#subscript-plug .spin-it").click(),commonGtmEvent("参与页中心点击","subscriptPlug","")):($("#subscript-plug .step-one").hide(),$("#subscript-plug .setp-two").show(),$(subscriptPlug).find(".m-box-head .title").text(languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".m-box-head .desc").text(languageMessageDtoList.participate_sub_title),commonGtmEvent("参与页中心点击","subscriptPlug",""))}),$(document).on("click","#subscript-plug .close",function(t){var e=getCookie("subscript-plug-close")||0;$("#subscript-plug").hide(),Number(e)<2?(e++,setCookie("subscript-plug-close",e)):""!=getCookie("subscript-success")&&getCookie("subscript-success")||$(".teaser-app .close").show(),commonGtmEvent("参与页关闭按钮","subscriptPlug","")}),$(document).on("click","#subscript-plug .subscript-btn-add-cart",function(t){let e=$(this).attr("pid"),s=$(this).attr("code");e&&(commonGtmEvent("完成页加车按钮","subscriptPlug",""),addToCart(e)),setTimeout(function(){addtoCartTag(subscribeObj.userEmail),""!==s&&window.discountOnCartProApp.applyCode(s),$("#subscript-plug").hide()},1e3)}),$(document).on("click",".teaser-app .teaser-image",function(t){$("#subscript-plug").show(),commonGtmEvent("Teaser打开","subscriptPlug","")}),$(document).on("click",".teaser-app .close",function(t){$("#subscript-plug").hide(),$(".teaser-app").remove(),commonGtmEvent("Teaser关闭","subscriptPlug","")}),$("#subscript-plug .j_user_email").on("input",function(){var t=$(this);""!==t.val().trim()&&t.closest(".input-email").removeClass("error")})});const eventList=["keydown","mousedown","mousemove","wheel","touchmove","touchstart","touchend"];