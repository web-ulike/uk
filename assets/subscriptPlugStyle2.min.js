function getActiveConfig(){setCookie("subscript-First-Visit",subscribeActFrom.resourceId,2),getBenefitList(subscribeActFrom.resourceId),subscribeObj.activityId=subscribeActFrom.resourceId,formatActiveData(),setCookie("subscript-plug-close",0)}function getCurrentActivity(t){var e=t[0];const i=getCookie("subscript-First-Visit");if(i&&(result=t.find(t=>t.resourceId===i),result))return result;if(t.length>1){var s=[];for(let e=0;e<t.length;e++){const i=t[e];let n=-1;var o=reverseTransform(i.targetPluginDtoList),r=!1;o.urlViewArr.forEach(function(t){pathname.indexOf(t.url)>-1&&pathname.length==t.url.length&&(r=!0)}),(0==o.radioView||1==o.radioView&&r||2==o.radioView&&!r)&&(n=e),s.push({createTime:i.createTime,radioView:o.radioView,actIndex:n})}s.sort((t,e)=>parseInt(t.createTime)-parseInt(e.createTime));let e=s.find(t=>"1"===t.radioView&&-1!==t.actIndex);if(e||(e=s.find(t=>"0"===t.radioView)),e)return t[e.actIndex];console.error("没有符合条件的对象")}return e}function formatActiveData(){turntable.targetId=subscribeActFrom.currentData.targetId,lottery=[],_formActive=subscribeActFrom.formActive,languageMessageDtoList=subscribeActFrom.languageMessData,activityItem=subscribeActFrom.currentData.resourceObject.activityItemDtoList;for(var t=0;t<activityItem.length;t++){let e=activityItem[t];lottery.push({location:t,title:e.itemName,url:e.extend.prizeUrl,itemType:e.itemType,bgColor:_formActive.turntable_prize_arr[t].bg_color,bg2Color:_formActive.turntable_prize_arr[t].bg2_color,fontSize:_formActive.turntable_prize_arr[t].font_size,mfontSize:_formActive.turntable_prize_arr[t].m_font_size,fontColor:_formActive.turntable_prize_arr[t].font_color})}turntable.itemNum=lottery.length,$(subscriptPlug).find(".step-one .title").html(languageMessageDtoList.index_title).attr("title",languageMessageDtoList.index_title),$(subscriptPlug).find(".step-one .desc").html(languageMessageDtoList.index_sub_title).attr("title",languageMessageDtoList.index_sub_title),$(subscriptPlug).find(".slide-left .abs-prize-pictures img").attr("data-src",_formActive.turntable_cover_url),$(".teaser-app").find(".teaser-image").attr("src",_formActive.turntable_teaser_url),$(subscriptPlug).find(".slide-left .pointer img").attr("data-src",_formActive.turntable_logo_url);var e=`<p>${languageMessageDtoList.index_sub_desc.replace(/\n/g,"</p><p>")}</p>`;$(subscriptPlug).find(".step-one .info").html(e),languageMessageDtoList.participate_receive_text.trim()?$(subscriptPlug).find(".box-receive .text").text(languageMessageDtoList.participate_receive_text):$(subscriptPlug).find(".box-receive").hide();var i=`<p>${languageMessageDtoList.participate_desc.replace(/\n/g,"</p><p>")}</p>`;if($(subscriptPlug).find(".setp-two .box-marketing").html(i),$(subscriptPlug).find(".setp-two .spin-it").text(languageMessageDtoList.btn_title),$(subscriptPlug).find(".m-box-head .title").text(languageMessageDtoList.index_title),$(subscriptPlug).find(".m-box-head .desc").text(languageMessageDtoList.index_sub_title),$(subscriptPlug).find(".slide-left .title").html(languageMessageDtoList.participate_main_title).attr("title",languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".setp-two .title").html(languageMessageDtoList.participate_main_title).attr("title",languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".setp-two .desc").html(languageMessageDtoList.participate_sub_title).attr("title",languageMessageDtoList.participate_sub_title),$(subscriptPlug).find(".setp-two .j_user_email").attr("placeholder",languageMessageDtoList.participate_email),$(subscriptPlug).find(".setp-two .input-phone").attr("placeholder",languageMessageDtoList.participate_phone),$(subscriptPlug).find(".success-popup .title").text(languageMessageDtoList.winning_title),$(subscriptPlug).find(".success-popup .desc").text(languageMessageDtoList.winning_sub_title),$(subscriptPlug).find(".success-popup .expire").text(languageMessageDtoList.winning_code_title),_formActive.turntable_arrow_url&&$(subscriptPlug).find(".abs-prize-arrow img").attr("data-src",_formActive.turntable_arrow_url),$(subscriptPlug).find(".turntable-wrap").css({"border-color":_formActive.turntable_bg_color,"box-shadow":"0 0 5px "+_formActive.turntable_bg_color}),$(subscriptPlug).css({"--title-color":_formActive.turntable_font_color,"--turntable_font_color":_formActive.turntable_bg_color,"--turntable_btn_color":_formActive.turntable_btn_color,"--turntable_btnfont_color":_formActive.turntable_btnfont_color,"--success_font_color":_formActive.success_font_color,"--turntable_font_bg_color":_formActive.t_bg_font_color,"--turntable_bg_color":_formActive.t_bg_color}),turntable.lottery=lottery,turntable.init(),pageControl(_formActive),"1"==_formActive.is_mobile){let e="";for(t=0;t<phoneList.length;t++){let i=phoneList[t],s=` <li data-code="${i.mcode}" data-chosen="${i.code}">\n        ${i.key}\n        <span class="flag-icon" data-chosen="${i.code}">\n        </span>\n      </li>`;e+=s}$(".dropdown-menu").html(e),$(".box-phone").show()}else $(".box-phone").hide()}function pageControl(t){var e=!1;t.urlViewArr.forEach(function(t){pathname.indexOf(t.url)>-1&&pathname.length==t.url.length&&(e=!0)}),(0==t.radioView||1==t.radioView&&e||2==t.radioView&&!e)&&showSubscriptionPopup(t),"0"==t.teaser&&$(".teaser-app").fadeIn("slow")}function showSubscriptionPopup(t){let e="visitor-times"+turntable.targetId,i="visitor-day"+turntable.targetId;setTimeout(function(){if("0"==t.text_device||!isMobile()&&"1"==t.text_device||isMobile()&&"2"==t.text_device){let s=getCookie(e)?parseInt(getCookie(e))+1:1;if("1"==t.viewObj&&parseInt(t.text_viewNum)>=s)setCookie(e,s),commonGtmEvent("转盘展示次数","subscriptPlug",""),window.addEventListener("scroll",triggerSubscription);else if("2"!=t.viewObj||Boolean(getCookie(i))){if(shouldDisplay()){let t=getTodayDate();window.addEventListener("scroll",triggerSubscription);const e=JSON.parse(localStorage.getItem("subscript-displayData"))||{date:t,count:0};commonGtmEvent("订阅插件-皮肤1",`转盘${e.count}次访问弹出`,e.count)}}else setCookie(i,!0,t.text_viewDay,!0),window.addEventListener("scroll",triggerSubscription),commonGtmEvent("转盘展示次数","subscriptPlug","")}},1e3*Number(t.text_in_show))}function triggerSubscription(){const t=window.scrollY||document.documentElement.scrollTop;t>10&&(addShowSubscript(),window.removeEventListener("scroll",triggerSubscription))}function addShowSubscript(){const t=getTodayDate();sessionStorage.setItem("subscript-sessionDisplayed",t);const e=JSON.parse(localStorage.getItem("subscript-displayData"))||{date:t,count:0};e.date!==t&&(e.date=t,e.count=0),e.count++,localStorage.setItem("subscript-displayData",JSON.stringify(e)),localStorage.removeItem("isOpenScratchPrize"),toggleApp()}function shouldDisplay(){let t=getTodayDate();const e=sessionStorage.getItem("subscript-sessionDisplayed"),i=JSON.parse(localStorage.getItem("subscript-displayData"))||{date:t,count:0};return e!==t&&!(i.date===t&&i.count>=3)}function reverseTransform(t){function e(t){const{name:i,type:s,value:o}=t;if("array"===s){let t=o.map(t=>{let e={};return t.value.forEach(t=>{e[t.name]=t.value}),e});return{name:i,value:t}}return"object"===s?o.reduce((t,i)=>{const s=e(i);return t[s.name]=s.value,t},{}):{name:i,value:o}}return t.map(t=>{const i=e(t),s={};return void 0!==i&&(s[i.name]=i.value),s}).reduce((t,e)=>Object.assign(t,e),{})}function sendApiRequest(t,e){e.siteCode="UK",e.language=window.Shopify.locale;var i={url:api+t,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};return new Promise((t,e)=>{$.ajax(i).done(function(e){t(e)}).fail(function(t){console.error("Error during API call:",t),e(t)})})}function getBenefitList(t){let e={pageNo:1,pageSize:100,includeCount:!1,activityId:t,activityType:"SUBSCRIBE_ACTIVITY"};sendApiRequest("/promotion/queryBenefitInfoList",e).then(t=>{if(0==t.code){const e=t.data;if(e&&e.length>0){let t="";for(let i=0;i<e.length;i++){let s=e[i];t+=`<li>${s.userEmail} won <span>${s.benefitName}</span></li>`}subscriptPlug.find(".scroll .list").html(t),setInterval(function(){autoScroll("#subscript-plug .scroll")},3e3)}}})}function updateSuccessDom(t){var e=t.benefitName;subscribeObj.userEmail=t.userEmail;let i=`<span class="info">${e}</span>`;if($("#subscript-plug .success-popup .left-code").html(i),"GOODS_VIRTUAL"==t.benefitType){$(subscriptPlug).find(".recommended-products").hide();let e=`<img src="${t.prizeUrl}" /> <p class="tips">${t.winning_code_title}</p>`;$(subscriptPlug).find(".success-popup .award-coupon").html(e)}else t.variantData?($(subscriptPlug).find(".recommended-products .image-left img").attr("src",t.variantData.imageUrl),$(subscriptPlug).find(".recommended-products .product-right .name").html(t.variantData.productDto.title),$(subscriptPlug).find(".recommended-products .product-right .price").html(shopCurrencySymbol+t.variantData.price.amount),$(subscriptPlug).find(".recommended-products .product-right .subscript-btn-add-cart").attr("pid",t.variantData.variantId),$("#subscript-plug .success-popup .subscript-btn-add-cart").attr("code",t.resourceId),$(subscriptPlug).find(".award-coupon .dispatch-coupon-txt").attr("data-text",e),$(subscriptPlug).find(".award-coupon .dispatch-coupon-txt span").text(e)):t.award_info?$(subscriptPlug).find(".box-codes .right-detail").html(t.award_info):($("#subscript-plug .success-popup .right-detail .text-code span").text(t.resourceId),$("#subscript-plug .success-popup .subscript-btn-add-cart").attr("code",t.resourceId));setTimeout(function(){$(subscriptPlug).find(".subscription-popup").hide(),$(subscriptPlug).find(".success-popup").show()},3e3),$(".teaser-image").attr("src","https://cdn.shopify.com/s/files/1/0656/9079/6273/files/Frame_457393925.svg?v=1715667081"),$(".teaser-app").show()}function addtoCartTag(t){let e={userEmail:t,userPhone:"",since:"USER_SUBSCRIBE",tags:["Spin-ATC"]};sendUlikeApi("/user/userSubscribe",e)}function validatePhoneNumber(t){const e=/^(\+|00)?[\d\s-]{0,4}?[\s-]?(\(?\d+\)?[\s-]?){1,6}\d+$/;return e.test(t)}function validateEmail(t){const e=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;return e.test(t)}function autoScroll(t){gsap.to($(t).find(".list"),{duration:.5,y:-25,onComplete:function(){$(t).find(".list").append($(t).find("li:first")),gsap.set($(t).find(".list"),{y:0})}})}function toggleApp(){isOpen()?($(".gift-box").hide(),ulikeSubscribe.hasClass("small-circle")&&animateValue({start:150,end:0,duration:600,onUpdate:t=>{ulikeSubscribe.css("--clip-path",`${150-t}%`),ulikeSubscribe.css("--origin-x",`${t}%`),ulikeSubscribe.css("--origin-y",`${t}%`)},onComplete:()=>{}}),$("#subscript-plug").show(),ulikeSubscribe.show()):(ulikeSubscribe.show(),setTimeout(function(){$(".gift-box").addClass("open-hz")},1e3),$(".gift-box").show(),setTimeout(function(){$(".gift-box").hide(),$("#subscript-plug").fadeIn(10,()=>{isOpen("isOpen")})},2e3))}function toggleAppClose(){const t=$(".teaser-app")[0].getBoundingClientRect(),e=t.left+20,i=t.top+20;ulikeSubscribe.find(".scratch-prize-close").fadeOut(),ulikeSubscribe.css("--origin-x",`${e}px`),ulikeSubscribe.css("--origin-y",`${i}px`),ulikeSubscribe.addClass("small-circle"),animateValue({start:0,end:150,duration:600,onUpdate:t=>{ulikeSubscribe.css("--clip-path",`${150-t}%`)},onComplete:()=>{ulikeSubscribe.hide(),$(".teaser-app").show()}})}function animateValue({start:t,end:e,duration:i,onUpdate:s,onComplete:o}){function r(a){const c=a-n,u=Math.min(c/i,1),l=t+(e-t)*u;s(l),u<1?requestAnimationFrame(r):o&&o()}const n=performance.now();requestAnimationFrame(r)}function getTodayDate(){const t=new Date;return t.toISOString().split("T")[0]}function isOpen(t){return!0}var turntable={itemNum:6,targetId:0,turntable:$("#turntable"),bg:null,gift:null,pointer:null,lottery:[],isGoing:!1,init(){if(!this.lottery.length)throw $(this.pointer).hide(),new Error("请设置中奖结果数据");$(this.bg).width(),this.itemNum;var t="";switch(this.itemNum){case 2:t="polygon(-8% 50%, 100% 50%, 100%  -130%)";break;case 3:t="polygon(50% 50%,95% 16%,-330px -76%)";break;case 4:t="polygon(50% 50%,100% 0%,0% 0%)";break;case 5:t="polygon(50% 50%,100% 76%,100% 0%)";break;case 6:t="polygon(50% 50%,-20% -70%, 110% -50%)";break;case 7:t="polygon(30% 80%, 80% 10%, 10% 20%)";break;case 8:t="polygon(50% 50%, 100% 30%, 88% -48%)";break;case 9:t="polygon(50% 50%, 100% 23%, 100% -100%)"}$("#subscript-plug").css({"--var-clip-path":t});for(let t=0;t<this.itemNum;t++){let i=360/this.itemNum*t;var e=this.lottery[t].bgColor;this.lottery[t].bg2Color&&(e=`linear-gradient(to bottom, ${this.lottery[t].bgColor}, ${this.lottery[t].bg2Color})`),$("<li>").css({transform:`rotate(${i}deg)`,background:e}).appendTo(this.bg);let s=isMobile()?this.lottery[t].mfontSize:this.lottery[t].fontSize,o=$("<li>").addClass("active").css({transform:`rotate(${i}deg)`,color:this.lottery[t].fontColor,"font-size":s+"px"}),r="",n=this.lottery[t].title,a=`<span class="sub-name">${n}</span>`;if("COUPON"==this.lottery[t].itemType){let e='style="transform: rotate(90deg);"';1==t&&(e='style="transform: rotate(-90deg);"'),a=`<span class="sub-name" index=${t} ${e} ><div class="award-coupon" >\n                <img alt="${n} coupon" src="https://cdn.shopify.com/s/files/1/0740/5882/6015/files/20240911-100539.png?v=1726024646" loading="lazy">\n                <div class="dispatch-coupon-txt" data-text="${n}" ><span>${n}</span></div>\n              </div></span>`}else this.lottery[t].url&&(r=`<img src="${this.lottery[t].url}" alt="${n} image" loading="lazy" />`);$(`<div class="prize-item">\n            ${a}\n            ${r}\n          </div>`).appendTo(o),$(this.gift).append(o)}},gameStart(t){if(this.isGoing)return;$(".turntable").removeClass("spin-start"),$("#turntable").css({transform:"",transition:""}),this.isGoing=!0;let e=this.lottery.find(e=>e.title==t.benefitName),i=(this.lottery.length-e.location)*(360/this.lottery.length),s=i+360*this.lottery.length*1.5,o=(i/360*this.lottery.length).toFixed(2)+1;setTimeout(function(){$("#turntable").css({transform:`rotate(${s}deg)`,transition:`transform ${o}s cubic-bezier(0.5, 0.1, 0.1, 1)`})},10),t.winning_title=languageMessageDtoList.winning_title,t.winning_sub_title=languageMessageDtoList.winning_sub_title,t.winning_code_title=languageMessageDtoList.winning_code_title,t.prizeUrl=e.url,commonGtmEvent("参与页成功订阅","subscriptPlug",""),sendApiRequest("/promotion/queryVariant",{variantId:t.extend.participantId}).then(e=>{if(0===e.code){let i=e.data;t.award_info=_formActive.award_info,t.userEmail=subscribeObj.userEmail,t.variantData=i,setTimeout(function(){this.isGoing=!1,subscriptPlug.find("#myConfettiDiv").show();const e=document.getElementById("confettiCanvas"),i=confetti.create(e,{resize:!0,useWorker:!0});i({particleCount:400,spread:100,origin:{y:.6},colors:["#F2D08E","#FDECC8","#F2D08E"]}),updateSuccessDom(t)},5e3),setCookie("subscript-success",!0,2,!0),setCookie("subscript-success-data",JSON.stringify(t),2,!0),setCookie("subscript-isSubscribe",!0,30,!0),setCookie("subscript-success-activeFrom",subscribeActFrom.formActive.theme,2,!0)}})}};let lottery=[];var activityId="";const subscriptPlug=$("#subscript-plug"),ulikeSubscribe=$(".ulike-subscribe"),subscribeObj={name:"",userEmail:"",phoneNumber:"",activityId:"",utmSource:"",extend:{utm_source:""},isMarketing:!1};var _formActive={},pathname=window.location.origin+location.pathname;let languageMessageDtoList={};$(function(){turntable.light=$("#turntable_light")[0],turntable.bg=$("#turntable_bg")[0],turntable.gift=$("#turntable_gift")[0];let t=getCookie("subscript-success-data"),e=getCookie("subscript-success-activeFrom");getCookie("subscript-success")&&""!=t&&""!=e?t&&(t=JSON.parse(t),$(subscriptPlug).find(".success-popup .title").text(t.winning_title),$(subscriptPlug).find(".success-popup .desc").text(t.winning_sub_title),$(subscriptPlug).find(".subscription-popup").hide(),updateSuccessDom(t)):getActiveConfig(),$(document).on("click","#subscript-plug .btn-wrap",function(t){$("#subscript-plug .step-one").hide(),$("#subscript-plug .setp-two").show(),$(subscriptPlug).find(".m-box-head .title").text(languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".m-box-head .desc").text(languageMessageDtoList.participate_sub_title),commonGtmEvent("首页Spin按钮","subscriptPlug","")}),$(".dropdown-selected").click(function(){$(".dropdown-menu").toggle()}),$(document).on("click",".dropdown-menu li",function(){var t=$(this).data("code"),e=$(this).data("chosen");$(".dropdown-selected .country-code").text(t),$(".dropdown-selected .flag-icon").attr("data-chosen",e),$(".dropdown-menu").hide()}),$(document).on("click","#subscript-plug .spin-it",function(t){commonGtmEvent("参与页订阅按钮","subscriptPlug",""),$("#subscript-plug .msg").hide().find("span").text(""),$(this).prop("disabled",!0);const e=new URLSearchParams(window.location.search);let i=e.get("utm_source");if(subscribeObj.utmSource=i,subscribeObj.userEmail=$("#subscript-plug  .j_user_email").val(),""==subscribeObj.userEmail)return $(this).prop("disabled",!1),$("#subscript-plug .msg").show().find("span").text(subscriptCopywriting.email_err),void $(subscriptPlug).find(".input-email").addClass("error");if(!validateEmail(subscribeObj.userEmail))return $(this).prop("disabled",!1),$("#subscript-plug .msg").show().find("span").text(languageMessageDtoList.participate_email_err),void $(subscriptPlug).find(".input-email").addClass("error");if(!subscribeObj.isMarketing&&""!=languageMessageDtoList.participate_receive_text.trim())return $("#subscript-plug .msg").show().find("span").text(subscriptCopywriting.privacy_policy_err),$(this).prop("disabled",!1),!1;if("1"==_formActive.is_mobile){let t=$(".box-phone .dropdown .country-code").text(),e=$("#subscript-plug  .input-phone").val();if(!validatePhoneNumber(e))return $(this).prop("disabled",!1),void $("#subscript-plug .msg").show().find("span").text(languageMessageDtoList.participate_phone_err);subscribeObj.phoneNumber=t+"-"+e}sendApiRequest("/promotion/sendBenefit",subscribeObj).then(t=>{if(0==t.code){isMobile()?(subscriptPlug.find(".spin-popup .slide-left").css("top","-120px"),subscriptPlug.find(".subscription-popup").css({top:"60%"})):subscriptPlug.find(".spin-popup .slide-left").css("top","-110px"),subscriptPlug.find(".spin-popup .slide-right").hide(),subscriptPlug.find(".subscription-popup").removeClass("spin-popup");let e=t.data;turntable.gameStart(e)}else 99998==t.code?($("#subscript-plug .msg").show().find("span").text(languageMessageDtoList[t.message]),$(this).prop("disabled",!1)):($("#subscript-plug .msg").show().find("span").text(subscriptCopywriting.system_err),$(this).prop("disabled",!1))}).catch(t=>{$(this).prop("disabled",!1),reject(t)})}),$(document).on("click","#subscript-plug .setp-two .box-receive",function(t){$("#policy-checkbox").prop("checked")?(subscribeObj.isMarketing=!1,$("#policy-checkbox").prop("checked",!1)):(subscribeObj.isMarketing=!0,$("#policy-checkbox").prop("checked",!0))}),$(document).on("click","#subscript-plug #turntable_pointer",function(t){$("#subscript-plug .setp-two").is(":visible")?($("#subscript-plug .spin-it").click(),commonGtmEvent("参与页中心点击","subscriptPlug","")):($("#subscript-plug .step-one").hide(),$("#subscript-plug .setp-two").show(),$(subscriptPlug).find(".m-box-head .title").text(languageMessageDtoList.participate_main_title),$(subscriptPlug).find(".m-box-head .desc").text(languageMessageDtoList.participate_sub_title),commonGtmEvent("参与页中心点击","subscriptPlug",""))}),$(document).on("click",".teaser-app .teaser-image",function(t){toggleApp(),commonGtmEvent("Teaser打开","subscriptPlug","")}),$(document).on("click","#subscript-plug .close",function(t){var e=getCookie("subscript-plug-close")||0;toggleAppClose(),Number(e)<2?(e++,setCookie("subscript-plug-close",e)):""!=getCookie("subscript-success")&&getCookie("subscript-success")||$(".teaser-app .close").show(),commonGtmEvent("参与页关闭按钮","subscriptPlug","")}),$(document).on("click","#subscript-plug .subscript-btn-add-cart",function(t){let e=$(this).attr("pid"),i=$(this).attr("code");e&&(commonGtmEvent("完成页加车按钮","subscriptPlug",""),addToCart(e)),setTimeout(function(){addtoCartTag(subscribeObj.userEmail),""!==i&&autoDiscountCode(i),toggleAppClose()},2e3)}),$(document).on("click",".teaser-app .close",function(t){ulikeSubscribe.hide(),$(".teaser-app").remove(),commonGtmEvent("Teaser关闭","subscriptPlug","")}),$("#subscript-plug .j_user_email").on("input",function(){var t=$(this);""!==t.val().trim()&&t.closest(".input-email").removeClass("error")})});var originalPosition={},app=$("#app"),init=$("#init"),zp=$("#zp"),button=$("button");ulikeSubscribe.find(".gift-box-cont").on("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){$(".gift-box").addClass("open-hz")}),ulikeSubscribe.find(".cp-hz").on("transitionend",()=>{toggleApp()});