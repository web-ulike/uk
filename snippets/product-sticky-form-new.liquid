{%- assign color_label_list = 'general.label.color' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign color_white_label = 'general.label.white' | t | downcase -%}
{%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: product.id -%}
{%- assign variant_picker_block = section.blocks | where: 'type', 'variant_picker' | first -%}
{%- assign buy_buttons_block = section.blocks | where: 'type', 'buy_buttons' | first -%}

{%- if buy_buttons_block != blank -%}
  <style>
    @media screen and (min-width: 1000px) {
      :root {
        --anchor-offset: 140px; /* When the sticky form is activate, every scroll must be offset by an extra value */
      }
    }
  </style>

  <product-sticky-form form-id="{{ product_form_id }}" hidden class="product-sticky-form">
    <div class="product-sticky-form__inner">
      <div class="product-sticky-form__content-wrapper hidden-pocket">
        <div class="product-sticky-form__info">
          <div class="product-sticky-form__bottom-info">
            <span class="product-sticky-form__title">{{ product.title }}</span>
          </div>
        </div>
      </div>
      <!-- Judge.me 代码开始 -->
      {% comment %} <div class="jdgm-widget jdgm-preview-badge" data-id="{{ product.id }}">
        {{ product.metafields.judgeme.badge }}
      </div> {% endcomment %}
      <!-- Judge.me 代码结束 -->

      {%- comment -%}This form is a simplified representation of the main form, and therefore uses its own code path{%- endcomment -%}
      <div class="product-sticky-form__form">
       {%- unless product.has_only_default_variant -%}
          <div
            class="product-sticky-form__variants"
          >
            {%- for option in product.options_with_values -%}
              {%- assign option_downcase = option.name | downcase -%}
              {%- capture option_id -%}sticky-form-option-{{ section.id }}-{{ forloop.index }}{%- endcapture -%}
              {%- assign color_swatch_config = settings.color_swatch_config | newline_to_br | split: '<br />' -%}

              <div class="select-wrapper">
                {%- assign downcase_value = option.selected_value | downcase -%}
                {%- for value in option.values -%}
                  <button
                    type="button"
                    role="option"
                    name="sticky_Variant"
                    class="combo-box__option-item"
                    value="{{ value | escape }}"
                    aria-selected="{% if value == option.selected_value %}true{% else %}false{% endif %}"
                  >
                    {%- if color_label_list contains option_downcase -%}
                      <span
                        class="combo-box__color-swatch"
                        aria-label="{{ value | escape }}"
                        style="{% render 'color-swatch-style', color_swatch_config: color_swatch_config, value: value %}"
                      ></span>
                    {%- endif -%}
                    <span style="display:none;">{{- value -}}</span>
                  </button>
                {%- endfor -%}
              </div>
            {%- endfor -%}
          </div>
        {%- endunless -%}

        <product-payment-container
          form-id="{{ product_form_id }}"
          class="product-sticky-form__payment-container {% if section.settings.price_txt != blank %}price-box-diy-pbox{% endif %}"
        >
          <button
            id="StickyAddToCart"
            is="loader-button"
            form="{{ product_form_id }}"
            type="submit"
            data-product-add-to-cart-button
            {% unless buy_buttons_block.settings.show_payment_button %}
              data-use-primary
            {% endunless %}
            data-button-content="{{  section.settings.text_add_cart }}"
            class="product-form__add-button button {% unless product.selected_or_first_available_variant.available %}button--ternary{% else %}{% if buy_buttons_block.settings.show_payment_button %}button--secondary{% else %}button--primary{% endif %}{% endunless %}"
          >
            {{ section.settings.text_add_cart }}
          </button>
        </product-payment-container>
      </div>
    </div>
  </product-sticky-form>
{%- endif -%}
