{%- liquid
  layout no
-%}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<!-- <script src="https://www.google.com/recaptcha/enterprise.js" ></script> -->
<!-- 
<form id="myForm" action="" method="POST" onsubmit="onSubmit(event)">
  <div id="recaptcha-container" class="g-recaptcha" 
       data-sitekey="6LfjxXgqAAAAAIbweF1gyoxNSYpHkKnAf623flIQ" 
       data-callback="onRecaptchaSuccess" 
       data-action="LOGIN">
  </div>
  <br/>
  <input type="button" value="Get Token" onclick="getToken()">
</form>


<script>
  function getToken() {
    // 确保 grecaptcha 对象已定义
    if (typeof grecaptcha !== "undefined") {
        grecaptcha.execute('6LfjxXgqAAAAAIbweF1gyoxNSYpHkKnAf623flIQ', {action: 'LOGIN'}).then(function(token) {
          // 获取到的 token
          console.log("reCAPTCHA Token:", token);
        });
    } else {
      console.error("reCAPTCHA 未加载。请检查脚本的加载情况。");
    }
  }
  function onRecaptchaSuccess(token){
    console.log(token);
  }
</script> -->

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" ></script>
<!-- 提交按钮 -->
<button onclick="handleSubmit()">提交</button>

<!-- 动态渲染 Turnstile 小部件的容器 -->
<div class="box-turn">
  <div id="turnstile-container"></div>
</div>
<div class="token">token: 是什么。。。。</div>
<script>
  let needsVerification = true;
  let widgetId = null;

  // 页面加载时直接渲染 Turnstile 小部件
  document.addEventListener("DOMContentLoaded", function () {
    $('.box-turn').hide();
    const container = document.getElementById("turnstile-container");

    // 直接渲染小部件
    widgetId = turnstile.render(container, {
      sitekey: '0x4AAAAAAAzyiFDavqgEj0lV',  // 替换为您的 sitekey
      execution: 'execute',                 // 设置为 execute 模式
      callback: onTurnstileSuccess,         // 成功回调
      'error-callback': onTurnstileError,    // 失败回调
      'timeout-callback': onTurnstileError
    });
  });

  // 点击提交按钮时的处理逻辑
  function handleSubmit() {
    if (needsVerification) {
      // 手动触发验证
      turnstile.execute(widgetId);
    } else {
      alert("提交成功！");
    }
  }

  // 验证成功回调
  function onTurnstileSuccess(token) {
    console.log("验证成功，令牌：", token);
    needsVerification = false;  // 验证通过，更新状态
    alert("验证成功，可以提交表单！");
    $('.token').text(token);
    $('#turnstile-container').hide();
  }

  // 验证失败回调
  function onTurnstileError() {
     $('.box-turn').show();
    console.log("验证失败，请重试！");
    alert("验证失败，请重试！");
  }
</script>
