<style>
.media-evaluation-box {
  padding: 60px 0 85px 0;
  position: relative;
  z-index: 1;
  overflow: hidden;
}

.media-evaluation-box .container {
  margin-bottom: 70px;
}

.media-evaluation-box .media-evaluation-marquee {
  position: relative;
}

.media-evaluation-box .media-evaluation-list {
  display: flex;
  padding: 20px 0;
  transition: transform 0.4s ease;
}

.media-evaluation-box .media-evaluation-item {
  width: 390px;
  margin-right: 15px;
  background: #F8F8F8;
  padding: 45px 32px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: flex-end;
  flex-shrink: 0;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
  border-radius: 20px;
  position: relative;
  z-index: 1;
}

.media-evaluation-box .hover-svg {
  position: absolute;
  width: 50px;
  height: auto;
  top: 46%;
  left: 35%;
  display: none;
  z-index: 1;
}

.media-evaluation-box .media-evaluation-item:hover {
  transform: translateY(-18px);
  box-shadow: 0 10px 23.2px rgba(55, 27, 11, 0.10);
}

.media-evaluation-box .media-evaluation-txt-top {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  position: relative;
}

.media-evaluation-box .media-evaluation-txt {
  font-size: 18px;
  color: #000;
  line-height: 1.3;
  font-weight: bold;
}

.media-evaluation-box .media-evaluation-logo {
  display: block;
  max-width: 60%;
  margin-top: 50px;
  max-height: 70px;
  width: auto;
}

.media-evaluation-box .sub-text {
  color: #3F3636;
  font-size: 20px;
  line-height: 1.2;
  text-align: center;
  margin-top: 20px;
}

.kol-diy .media-evaluation-box {
  background: #FFF;
}

.kol-diy .media-evaluation-box .media-evaluation-item {
  border-radius: 20px;
  background: #F8F8F8;
  padding-bottom: 30px;
}

.kol-diy .media-evaluation-box .media-evaluation-txt-top {
  justify-content: flex-start;
}

@media (min-width: 992px) {
  .media-evaluation-box .media-evaluation-item:hover {
    cursor: url(https://cdn.shopify.com/s/files/1/0740/5882/6015/files/900f9d08c855c9a85f7f5a75ea3287cd.svg), auto;
  }
}

@media (max-width: 991px) {
  .media-evaluation-box {
    padding: 50px 0;
  }
  .media-evaluation-box .container {
    margin-bottom: 30px;
  }
  .media-evaluation-box .media-evaluation-item {
    width: 350px;
  }
  .media-evaluation-box .sub-text {
    font-size: 12px;
    margin-top: 10px;
  }
  .kol-diy .media-evaluation-box .media-evaluation-item {
    border-radius: 10px;
  }
  .media-evaluation-box .hover-svg {
    width: 40px;
    top: auto;
    bottom: 30px;
    left: 32px;
    display: block;
  }

  /* 移动端滚动条样式 */
  .media-evaluation-marquee-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  .media-evaluation-marquee-wrapper::-webkit-scrollbar {
    height: 6px;
  }
  .media-evaluation-marquee-wrapper::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.3);
    border-radius: 3px;
  }
  .media-evaluation-marquee-wrapper::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.05);
  }
}
</style>

<section class="section-box{% if section.settings.custom_class != blank %} {{section.settings.custom_class}}{% endif %}">
  <div class="media-evaluation-box">
    {% if section.settings.title != blank %}
      <div class="container">
        <div class="title-diy to-top">{{ section.settings.title }}</div>
        {% if section.settings.text != blank %}
          <div class="sub-text to-top">{{ section.settings.text }}</div>
        {% endif %}
      </div>
    {% endif %}

    <div class="media-evaluation-marquee">
      <!-- 移动端包裹可滚动容器 -->
      <div class="media-evaluation-marquee-wrapper">
        <div class="media-evaluation-list marquee-box-list">
          {% for block in section.blocks %}
            <a href="{{ block.settings.link }}" class="media-evaluation-item marquee-box-item to-top" style="transition-delay: 0.{{forloop.index}}s">
              <div class="media-evaluation-txt-top">
                <div class="media-evaluation-txt">{{ block.settings.text }}</div>
              </div>
              <img loading="lazy" class="media-evaluation-logo" width="{{ block.settings.image.width }}" height="{{ block.settings.image.height }}" {% render 'image-attributes', image: block.settings.image %} alt="{{ block.settings.image.alt | escape }}">
              <svg class="hover-svg" width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="30" cy="30" r="29.5" fill="white" stroke="#E1E1E1"/>
                <g clip-path="url(#clip0_6908_1903)">
                  <path d="M41.4961 20.8487C41.6127 20.9877 41.6769 21.1688 41.6666 21.357L40.8743 36.3495L39.4133 36.2725L40.1167 22.9613L18.9851 40.6928C18.4659 40.074 18.5467 39.1504 19.1655 38.6311L40.4395 20.7801C40.6513 20.6023 40.947 20.5358 41.205 20.6383C41.3215 20.6838 41.4199 20.7579 41.4961 20.8487Z" fill="#190A0A"/>
                  <path d="M38.6743 19.8674C38.6028 20.6724 37.8932 21.2679 37.0891 21.1975L25.9692 20.2257L26.0968 18.7681L38.6732 19.8683L38.6743 19.8674Z" fill="#190A0A"/>
                </g>
                <defs>
                  <clipPath id="clip0_6908_1903">
                    <rect width="30" height="22.9683" fill="white" transform="translate(11.1274 31.3286) rotate(-40)"/>
                  </clipPath>
                </defs>
              </svg>
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
function enableDragDetection(element, onDragLeft, onDragRight, onTouchEnd) {
  let startX=0, startY=0, isDragging=false, isMobile=false;
  const start=(x,y,mobile)=>{startX=x; startY=y; isDragging=true; isMobile=mobile;};
  const move=(x,y)=>{
    if(!isDragging) return;
    let deltaX=x-startX, deltaY=y-startY;
    if(Math.abs(deltaX)>Math.abs(deltaY)) {
      deltaX>0 ? onDragRight?.(Math.abs(deltaX)) : onDragLeft?.(Math.abs(deltaX));
    }
    startX=x; startY=y;
  };
  const end=()=>{ onTouchEnd?.(isMobile); isDragging=false; };
  element.addEventListener('touchstart', e=>start(e.touches[0].clientX, e.touches[0].clientY, true));
  element.addEventListener('touchmove', e=>move(e.touches[0].clientX, e.touches[0].clientY));
  element.addEventListener('touchend', end);
  element.addEventListener('mousedown', e=>{ e.preventDefault(); start(e.clientX,e.clientY,false); });
  element.addEventListener('mousemove', e=>move(e.clientX,e.clientY));
  element.addEventListener('mouseup', end);
  element.addEventListener('contextmenu', e=>e.preventDefault());
}

function marqueeFn(elName) {
  const content = document.querySelector("."+elName);
  const ul = content.querySelector(".marquee-box-list");
  const isMobile = window.innerWidth < 992;

  // 计算总宽度
  let liWidthAll=0;
  ul.querySelectorAll(".marquee-box-item").forEach(item=>{
    const style = getComputedStyle(item);
    liWidthAll += item.offsetWidth + parseInt(style.marginRight);
  });
  ul.style.width = liWidthAll + "px";

  if(!isMobile){
    // PC 自动滚动
    let left=0, speed=1;
    function run() {
      if(left < -ul.offsetWidth/2) left=0;
      left -= speed;
      ul.style.transform=`translateX(${left}px)`;
    }
    let timer=setInterval(run,10);
    content.onmouseover=()=>clearInterval(timer);
    content.onmouseout=()=>timer=setInterval(run,10);

    enableDragDetection(ul,
      d=>{ clearInterval(timer); left-=d; ul.style.transform=`translateX(${left}px)`; },
      d=>{ clearInterval(timer); left+=d; ul.style.transform=`translateX(${left}px)`; },
      ()=>{ timer=setInterval(run,10); }
    );
  } else {
    // 移动端不自动滚动，用户手动滑动
    enableDragDetection(ul,null,null,null);
  }
}

window.addEventListener('load', ()=>marqueeFn('marquee-box'));
window.addEventListener('resize', ()=>marqueeFn('marquee-box'));
</script>

{% schema %}
{
  "name": "media-evaluation-icon-new",
  "blocks": [
    {
      "name": "item",
      "type": "item",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "text", "label": "Text" },
        { "type": "url", "id": "link", "label": "链接" }
      ]
    }
  ],
  "settings": [
    { "type": "text", "id": "custom_class", "label": "Custom Class" },
    { "type": "text", "id": "title", "label": "Title" },
    { "type": "text", "id": "text", "label": "Text" }
  ],
  "presets": [{ "name": "media-evaluation-icon-new", "blocks": [] }]
}
{% endschema %}
