<style>
.summer-preheat {
  position: relative;
  z-index: 1;
}

.summer-preheat .summer-preheat-img {
  position: relative;
  z-index: 1;
  width: 100%;
  display: block;
  margin: 0;
}

.summer-preheat .summer-preheat-cont {
  position: absolute;
  width: 100%;
  top: 50%;
  left: 0;
  transform: translateY(-50%);
  z-index: 2;
}

.summer-preheat .left-panel {
  max-width: 470px;
}

.summer-preheat .left-panel .summer-preheat-h3 {
  color: #FFFFFC;
  font-size: 44px;
  font-family: var(--heading-font-family);
  line-height: 1.2;
  letter-spacing: 0.44px;
  font-weight: normal;
  margin: 0;
  margin-bottom: 15px;
}

.summer-preheat .left-panel .summer-preheat-p {
  color: #FFFFFC;
  font-size: 20px;
  line-height: 1.5;
  letter-spacing: 0.2px;
  margin: 0;
}

.summer-preheat .email-form {
  display: flex;
  flex-direction: column;
  gap: 30px;
  margin: 30px 0;
}

.summer-preheat .email-form input {
  width: 100%;
  border: none;
  color: #3F3636;
  font-size: 16px;
  height: 55px;
  background: #fff;
  padding: 0 30px;
  outline: 0;
}

.summer-preheat .email-form input::placeholder {
  opacity: .5;
}

.summer-preheat .email-form .summer-preheat-btn {
  width: 200px;
  height: 47px;
  background: #E0004D;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #FFF;
  font-size: 16px;
  font-family: var(--heading-font-family);
  cursor: pointer;
  transition: all .3s ease;
}

.summer-preheat .email-form .summer-preheat-btn:hover {
  background: #fff;
  color: #000;
}

.summer-preheat .countdown {
  display: flex;
  align-items: center;
  gap: 10px;
}

.summer-preheat .time-segment {
  display: flex;
  align-items: center;
  gap: 6px;
}

.summer-preheat .time-segment .num-label {
  color: #190A0A;
  font-size: 22px;
  line-height: 1;
  width: 34px;
  height: 37px;
  border-radius: 5px;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
}

.summer-preheat .time-label {
  color: #FFFFFC;
  font-size: 18px;
  font-family: var(--heading-font-family);
  line-height: 1.3;
}

.summer-preheat .time-separator {
  color: #FFFFFC;
  font-size: 28px;
  font-family: var(--heading-font-family);
  line-height: 1;
}

@media (max-width: 768px) {
  .summer-preheat .summer-preheat-cont {
    top: 15px;
    transform: translateY(0);
  }

  .summer-preheat .left-panel {
    max-width: none;
    text-align: center;
  }

  .summer-preheat .email-form {
    justify-content: center;
    margin: 16px 0;
    gap: 16px;
  }

  .summer-preheat .email-form input {
    height: 42px;
    font-size: 12px;
    padding: 0 20px;
  }

  .summer-preheat .email-form .summer-preheat-btn {
    width: 100%;
    height: 42px;
    font-size: 12px;
  }

  .summer-preheat .countdown {
    justify-content: center;
    gap: 5px;
  }

  .summer-preheat .time-label {
    display: none;
  }

  .summer-preheat .time-segment .num-label {
    height: 34px;
    font-size: 17px;
  }

  .summer-preheat .time-separator {
    font-size: 17px;
  }

  .summer-preheat .left-panel .summer-preheat-h3 {
    font-size: 28px;
    margin-bottom: 5px;
  }

  .summer-preheat .left-panel .summer-preheat-p {
    font-size: 16px;
  }
}
</style>
<section class="section-box">
  <div class="summer-preheat">
    <picture>
      <source srcset="{{ section.settings.image1 | image_url }}" media="(max-width: 991px)">
      <img class="summer-preheat-img" src="{{ section.settings.image | image_url }}" width="{{ section.settings.image.width }}" height="{{ section.settings.image.height }}" alt="{{ section.settings.image.alt }}">
    </picture>
    <div class="summer-preheat-cont">
      <div class="container">
        <div class="left-panel">
          {%- if section.settings.text != blank -%}
            <h3 class="summer-preheat-h3">{{ section.settings.text }}</h3>
          {%- endif -%}
          {%- if section.settings.text1 != blank -%}
            <p class="summer-preheat-p">{{ section.settings.text1 }}</p>
          {%- endif -%}
          <!-- onsubmit="window.Shopify.recaptchaV3.addToken(this, 'customer'); return false;" -->
          <form accept-charset="UTF-8" class="labs-form-el">
            <input type="hidden" name="form_type" value="customer">
            <input type="hidden" name="utf8" value="✓">
            <input type="hidden" name="contact[tags]" value="SSEARLY">
            <input type="hidden" name="contact[context]" value="">
            <div class="email-form">
              <input type="email" class="summer-preheat-email" id="newsletter[footer][contact][email]" name="contact[email]" required="" placeholder="{{ section.settings.text2 }}" />
              {%- if section.settings.text3 != blank -%}
                <button type="submit" class="summer-preheat-btn">{{ section.settings.text3 }}</button>
              {%- endif -%}
            </div>
          </form>
          
          {%- if section.settings.text4 != blank -%}
            <div class="countdown">
              <div class="time-segment">
                <span class="num-label" id="days">00</span>
                <span class="time-label">D</span>
              </div>
              <div class="time-separator">:</div>
              <div class="time-segment">
                <span class="num-label" id="hours">00</span>
                <span class="time-label">H</span>
              </div>
              <div class="time-separator">:</div>
              <div class="time-segment">
                <span class="num-label" id="minutes">00</span>
                <span class="time-label">M</span>
              </div>
              <div class="time-separator">:</div>
              <div class="time-segment">
                <span class="num-label" id="seconds">00</span>
                <span class="time-label">S</span>
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('.labs-form-el');
  
    form.addEventListener('submit', function (e) {
    e.preventDefault(); // ✅ 确保不会跳转

    // 创建真正发送数据的表单数据
    const realFormData = new FormData();
    realFormData.append('form_type', 'customer');
    realFormData.append('utf8', '✓');
    realFormData.append('contact[tags]', 'SSEARLY');
    realFormData.append('contact[context]', '');
    realFormData.append('contact[email]', document.querySelector('.summer-preheat-email').value);

    // 添加 ReCAPTCHA token 后再发送
      fetch('/contact#contact_form', {
        method: 'POST',
        body: realFormData,
        headers: {
          'Accept': 'text/html'
        }
      }).then(response => {
        if (response.ok) {
          console.log('提交成功');
          if("{{ section.settings.link }}"){
            location.href = "{{ section.settings.link }}"
          }
          form.reset();
        } else {
         console.log('提交失败');
        }
      }).catch(err => {
        console.error('网络错误', err);
        console.log('发生错误');
      });
  });
  });
  function summerPreheatStartCountdown(targetDateString) {
    const targetDate = new Date(targetDateString).getTime();
    const $summerPreheat = document.querySelector('.summer-preheat');
    const daysEl = $summerPreheat.querySelector('#days');
    const hoursEl = $summerPreheat.querySelector('#hours');
    const minutesEl = $summerPreheat.querySelector('#minutes');
    const secondsEl = $summerPreheat.querySelector('#seconds');

    if (!daysEl || !hoursEl || !minutesEl || !secondsEl) {
      console.error("Countdown elements not found!");
      return;
    }

    function updateCountdown() {
      const now = new Date().getTime();
      const distance = targetDate - now;

      if (distance < 0) {
        daysEl.textContent = '00';
        hoursEl.textContent = '00';
        minutesEl.textContent = '00';
        secondsEl.textContent = '00';
        clearInterval(interval);
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      daysEl.textContent = String(days).padStart(2, '0');
      hoursEl.textContent = String(hours).padStart(2, '0');
      minutesEl.textContent = String(minutes).padStart(2, '0');
      secondsEl.textContent = String(seconds).padStart(2, '0');
    }

    updateCountdown();
    const interval = setInterval(updateCountdown, 1000);
  }

  document.addEventListener('DOMContentLoaded', () => {
    {%- if section.settings.text4 != blank -%}
      summerPreheatStartCountdown('{{ section.settings.text4 }}');
    {%- endif -%}
  });
</script>
{% schema %}
{
"name": "summer-preheat",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "image_picker",
      "id": "image1",
      "label": "Image M"
    },
    {
      "type": "text",
      "id": "text",
      "label": "Title"
    },
    {
      "type": "text",
      "id": "text1",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text2",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text3",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text4",
      "label": "结束时间"
    },
    {
      "type": "url",
      "id": "link",
      "label": "提交成功跳转链接"
    }
  ],
  "presets": [
  {
    "name": "summer-preheat",
    "blocks": []
  }
]
}
{% endschema %}