<style>
  .ipl-results {
    background: #f9f9f9;
    padding: 80px 0;
  }

  .timeline .timeline-item.active::after {
    border: 1px solid #3f3636;
  }

  .ipl-results .ipl-results-sub {
    font-size: 16px;
    color: #000;
    margin-top: 25px;
    text-align: center;
  }

  .ipl-results .ipl-results-cont {
    margin-top: 50px;
    display: flex;
    align-items: center;
    gap: 100px;
  }

  .ipl-results .ipl-results-compare {
    width: 60%;
    display: flex;
    gap: 16px;
  }

  .ipl-results .ipl-progress-item {
    margin-bottom: 35px;
    --lin-width: 0;
  }

  .ipl-results .ipl-progress-item:last-child {
    margin-bottom: 0;
  }

  .ipl-results .ipl-progress-num {
    font-size: 60px;
    font-family: var(--heading-font-family);
    line-height: 1;
  }

  .ipl-results .ipl-results-p {
    font-size: 18px;
    color: #b3b3b3;
    line-height: 1.2;
    margin-top: 15px;
  }

  .ipl-results .ipl-results-lin {
    position: relative;
    height: 6px;
    background: #e3e3e3;
    border-radius: 6px;
    margin-top: 20px;
  }

  .ipl-results .ipl-results-lin::before {
    position: absolute;
    content: '';
    display: block;
    height: 100%;
    left: 0;
    top: 0;
    width: 0;
    background: #000;
    border-radius: 6px;
    transition: width 0.7s 0.5s cubic-bezier(0.4, 0.2, 0.2, 1);
  }

  .ipl-results .appear .ipl-results-lin::before {
    width: var(--lin-width);
  }

  .ipl-results .before-after-img-wrapper {
    position: relative;
    --img-width: 0px;
    --left-num: 100%;
    --time-num: 1s;
    overflow: hidden;
    width: 100%;
  }

  .ipl-results .before-after-img-item {
    position: relative;
    z-index: 1;
    pointer-events: none;
    height: 100%;
  }

  .ipl-results .before-after-img-box {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    overflow: hidden;
  }

  .ipl-results .before-after-img-item .img {
    /* display: none; */
    width: 100%;
    height: 100%;
    user-select: none;
    pointer-events: none;
    user-drag: none;
    -moz-user-drag: none;
    -webkit-user-drag: none;
  }

  .ipl-results .before-after-img-item .img.active {
    display: block;
  }
  .ipl-results .before-after-img-box.close {
    z-index: 3;
    width: 0;
    transition: width 0.7s cubic-bezier(0.4, 0.2, 0.2, 1);
  }
  .ipl-results .before-after-img-box.close .img {
    height: 100%;
    width: var(--img-width);
    max-width: none;
  }
  .ipl-results .before-after-img-box.active {
    position: relative;
    z-index: 2;
  }

  .ipl-results .before-after-img-right {
    position: absolute;
    width: calc(100% - var(--left-num));
    height: 100%;
    overflow: hidden;
    z-index: 2;
    right: 0;
    top: 0;
    transition: all var(--time-num) cubic-bezier(0.645, 0.045, 0.355, 1) 0s;
  }

  .ipl-results .before-after-img-right .img {
    height: 100%;
    width: var(--img-width);
    max-width: none;
    position: absolute;
    right: 0;
    top: 0;
  }

  .ipl-results .before-after-tag {
    position: absolute;
    padding: 5px 15px;
    font-size: 14px;
    color: #fff;
    background: rgba(0, 0, 0, 0.4);
    top: 15px;
    left: 15px;
    z-index: 4;
  }

  .ipl-results .before-after-img-right .before-after-tag {
    left: auto;
    right: 15px;
  }

  .ipl-results .before-after-img-handle {
    position: absolute;
    z-index: 5;
    top: 0;
    height: 100%;
    left: var(--left-num);
    transition: all var(--time-num) cubic-bezier(0.645, 0.045, 0.355, 1) 0s;
  }

  .ipl-results .before-after-img-handle::before,
  .ipl-results .before-after-img-handle::after {
    position: absolute;
    content: '';
    display: block;
    width: 2px;
    height: calc(50% - 25px);
    left: 50%;
    transform: translateX(-50%);
    background: #fff;
  }

  .ipl-results .before-after-img-handle::before {
    top: 0;
  }

  .ipl-results .before-after-img-handle::after {
    bottom: 0;
  }

  .ipl-results .before-after-img-handle-btn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    cursor: col-resize;
    border-radius: 50%;
    border: 2px solid #fff;
    overflow: hidden;
    width: 50px;
    height: 50px;
  }

  .ipl-results .before-after-img-handle-btn span {
    position: absolute;
    width: 200%;
    height: 200%;
    background: rgba(255, 255, 255, 0.5);
    filter: blur(10px);
    z-index: 1;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .plus-icon {
    vertical-align: text-top;
    width: 24.25px;
    height: 24.25px;
  }
  .ipl-results .before-after-img-handle-btn::before,
  .ipl-results .before-after-img-handle-btn::after {
    position: absolute;
    content: '';
    display: block;
    border: 12px solid transparent;
    border-color: transparent #fff transparent transparent;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
  }

  .ipl-results .before-after-img-handle-btn::before {
    margin-left: -16px;
  }

  .ipl-results .before-after-img-handle-btn::after {
    transform: translate(-50%, -50%) scale(-1, -1);
    margin-left: 16px;
  }

  .ipl-results .ipl-results-compare-sm {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    flex: 1;
  }
  .ipl-results .timeline {
    position: relative;
    width: 600px;
    margin: 0 auto;
  }

  .ipl-results .timeline .timeline-item {
    padding: 0px 0px 40px 50px;
    position: relative;
    background: inherit;
    border-radius: 6px;
    width: 100%;
    min-height: 80px;
    cursor: pointer;
  }

  .timeline .timeline-item::before {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    width: 1px;
    left: 30px;
    border-left: 1px dashed #ccc;
  }

  .timeline-item::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    left: 15px;
    background-color: white;
    border: 1px dashed #3f3636;
    top: 0px;
    border-radius: 50%;
    z-index: 1;
  }

  .timeline-item:last-child::before {
    content: none;
    background: initial;
  }

  .timeline-dot {
    position: absolute;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    left: 24px;
    top: 10px;
    z-index: 2;
    border: 1px solid #3f3636;
  }

  .timeline-date {
    font-size: 30px;
    font-family: var(--heading-font-family);
    margin: 0px 0px 10px 10px;
    line-height: 30px;
  }

  .timeline-content {
    padding: 20px;
    background-color: #ebfeff;
    margin-top: 10px;
    font-size: 20px;
    display: none;
  }
  .timeline-content p {
    margin: 0px;
  }
  .timeline-content .content-text {
    margin-top: 10px;
  }

  .timeline-content .content-title {
    color: #190a0a;
    display: flex;
    font-size: 22px;
    align-items: center;
    gap: 10px;
    font-family: var(--heading-font-family);
    line-height: 150%; /* 30px */
  }

  .timeline-content .content-title .tags {
    border-radius: 12px;
    border: 1px solid #e0004d;
    color: #e0004d;
    padding: 5px 14px;
    gap: 6px;
    display: flex;
    font-size: 20px;
    font-family: var(--text-font-family);
  }
  .timeline-content .content-title .tags span {
    font-family: var(--heading-font-family);
  }

  .timeline-item.active .timeline-content {
    display: block;
  }
  .timeline-item.active .timeline-dot {
    background: #3f3636;
  }
  .ipl-results .ipl-results-compare .results-tips {
    position: absolute;
    z-index: 11;
    bottom: 30px;
    width: 80%;
    color: #fffffc;
    text-align: center;
    font-size: 14px;
    font-weight: 400;
    line-height: 150%; /* 21px */
    margin: 0 auto;
    left: 0px;
    right: 0px;
  }

  .ipl-results .tark-our-quiz {
    color: #e0004d;
    text-align: left;
    font-size: 20px;
    font-weight: 400;
    line-height: 150%;
    text-decoration-line: underline;
    cursor: pointer;
    margin-left: 25px;
  }

  @media (max-width: 1400px) {
    .ipl-results .ipl-results-cont {
      gap: 40px;
    }
    .ipl-results .ipl-progress-num {
      font-size: 35px;
    }
    .ipl-results .ipl-results-p {
      font-size: 16px;
      margin-top: 10px;
    }
    .ipl-results .ipl-results-lin {
      margin-top: 10px;
    }
  }

  @media (max-width: 991px) {
    .ipl-results {
      padding: 50px 0;
    }
    .ipl-results .tark-our-quiz {
      font-size: 14px;
      margin-left: 0px;
    }
    .ipl-results .ipl-results-sub {
      font-size: 14px;
      margin-top: 15px;
    }
    .ipl-results .ipl-results-cont {
      flex-direction: column-reverse;
      gap: 30px;
      align-items: normal;
      margin-top: 30px;
    }
    .ipl-results .before-after-img-wrapper {
      width: 100%;
    }
    .ipl-results .ipl-results-compare {
      width: 100%;
      flex-direction: column;
      gap: 5px;
      display: none;
    }
    .ipl-results .before-after-img-handle-btn {
      width: 40px;
      height: 40px;
    }
    .ipl-results .before-after-img-handle::before,
    .ipl-results .before-after-img-handle::after {
      height: calc(50% - 20px);
    }
    .ipl-results .before-after-img-handle-btn::before,
    .ipl-results .before-after-img-handle-btn::after {
      zoom: 0.7;
    }
    .ipl-results .ipl-results-compare-sm {
      gap: 5px;
    }
    .ipl-results .before-after-tag {
      zoom: 0.8;
      padding: 3px 10px;
    }
    .ipl-results .ipl-progress-txt {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .ipl-results .ipl-results-p {
      margin-top: 0;
      font-size: 14px;
    }
    .ipl-results .ipl-results-lin {
      height: 4px;
    }
    .ipl-results .ipl-progress-item {
      margin-bottom: 20px;
    }
    .ipl-results .ipl-results-sm-item .ipl-results-txt {
      display: none;
    }

    .ipl-results .timeline {
      position: relative;
      width: 100%;
      margin: 0 auto;
    }

    .ipl-results .timeline .timeline-item {
      padding: 0px 0px 20px 30px;
      position: relative;
      background: inherit;
      border-radius: 6px;
      width: 100%;
      min-height: 30px;
      cursor: pointer;
    }

    .timeline .timeline-item::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      width: 1px;
      left: 10px;
      border-left: 1px dashed #ccc;
    }
    .plus-icon {
      vertical-align: text-top;
      width: 20.203px;
      height: 20.203px;
    }
    .timeline-item::after {
      width: 20px;
      height: 20px;
      left: 0px;
    }

    .timeline-item:last-child::before {
      content: none;
      background: initial;
    }

    .timeline-dot {
      width: 12px;
      height: 12px;
      left: 4px;
      top: 4px;
    }

    .timeline-date {
      font-size: 20px;
      margin: 0px 0px 10px 10px;
      line-height: 20px;
    }

    .timeline-content {
      padding: 20px;
      background-color: #ebfeff;
      margin-top: 10px;
      font-size: 20px;
      display: none;
    }
    .timeline-content p {
      margin: 0px;
    }
    .timeline-content .content-text {
      margin-top: 10px;
      font-size: 12px;
    }

    .timeline-content .content-title {
      color: #190a0a;
      display: flex;
      font-size: 12px;
      align-items: center;
      gap: 10px;
      line-height: 150%; /* 30px */
    }

    .timeline-content .content-title .tags {
      border-radius: 12px;
      border: 1px solid #e0004d;
      color: #e0004d;
      padding: 3px 8px;
      gap: 6px;
      font-size: 12px;
    }
    .timeline-content .content-title .tags span {
      font-family: var(--heading-font-family);
      font-size: 18px;
    }
    .image-temp:not(.image-temp)::after {
      border: 1px solid #3f3636;
    }
    .ipl-results .results-tips {
      font-size: 12px;
      line-height: 16px;
      color: #3f3636;
      opacity: 0.5;
      margin-top: 20px;
    }
  }
</style>
{%- liquid
  assign se_id = section.id
  assign se_bks = section.blocks
  assign se_stts = section.settings
-%}
<section class="section-box">
  <div class="ipl-results">
    <div class="container">
      <div class="ipl-results-sub to-top">{{ se_stts.title }}</div>
      <div class="title-diy  to-top" style="transition-delay: 0.1s">
        {{ se_stts.desc }}
      </div>
      <div class="ipl-results-cont">
        {% comment %} 时间 {% endcomment %}
        <div class="ipl-results-progress">
          {% comment %} 时间轴 {% endcomment %}
          <div class="timeline">
            {% for block in se_bks %}
              {% assign item = block.settings %}
              {%- if block.type == 'item' -%}
                <div
                  class="timeline-item {% if forloop.first %} active {% endif %}"
                >
                  <div class="timeline-dot"></div>
                  <div class="timeline-date">{{ item.title }}</div>
                  <div class="timeline-content">
                    <div class="content-title">
                      <div class="tags">
                        {{ item.tag }}
                      </div>
                      <div class="sub-title">{{ item.subtitle }}</div>
                    </div>
                    <p class="content-text">
                      {{ item.desc }}
                    </p>
                  </div>

                  <div class="image-temp"></div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
          <div class="tark-our-quiz show-match-box" style="display:flex">
            {{ se_stts.text5 }}
            <img
              src="https://cdn.shopify.com/s/files/1/0740/5882/6015/files/1_1f49d47e-04d5-4f85-9b07-bb2cd2c0359c.png?v=1720512907"
              class="plus-icon"
            >
          </div>
          <div class="results-tips hidden-desk">{{ se_stts.text4 }}</div>
        </div>
        <div class="ipl-results-compare 3333">
          <div class="before-after-img-wrapper to-top" style="transition-delay: 0.2s">
            <div class="before-after-img-item">
              {%- for block in section.blocks -%}
                <div class="before-after-img-box {% if forloop.index == 1 %}active{% endif %}">
                  {%- if block.settings.image != blank -%}
                    <img
                      loading="lazy"
                      class="img"
                      width="{{ block.settings.image.width }}"
                      height="{{ block.settings.image.height }}"
                      {% render 'image-attributes', image: block.settings.image %}
                      alt="{{ block.settings.image.alt | escape }}"
                    >
                  {%- endif -%}
                </div>
              {%- endfor -%}
              {%- if section.settings.text2 != blank -%}
                <div class="before-after-tag">{{ section.settings.text2 }}</div>
              {%- endif -%}
            </div>
            <div class="before-after-img-item before-after-img-right">
              {%- for block in section.blocks -%}
                <div class="before-after-img-box {% if forloop.index == 1 %}active{% endif %}">
                  {%- if block.settings.image1 != blank -%}
                    <img
                      loading="lazy"
                      class="img"
                      width="{{ block.settings.image1.width }}"
                      height="{{ block.settings.image1.height }}"
                      {% render 'image-attributes', image: block.settings.image1 %}
                      alt="{{ block.settings.image1.alt | escape }}"
                    >
                  {%- endif -%}
                </div>
              {%- endfor -%}
              {%- if section.settings.text3 != blank -%}
                <div class="before-after-tag">{{ section.settings.text3 }}</div>
              {%- endif -%}
            </div>
            <div class="before-after-img-handle">
              <div class="before-after-img-handle-btn">
                <span></span>
              </div>
            </div>
            {% comment %} 提示信息 {% endcomment %}
            <div class="results-tips hidden-phone">{{ se_stts.text4 }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    window.addEventListener('load', function () {
      $(document).on('click', '.ipl-results .timeline-item', function () {
        let index = $(this).index();
        let $imgBox = $('.ipl-results-compare .before-after-img-wrapper');

        let width = $imgBox[0].offsetWidth;
        $(this).addClass('active').siblings().removeClass('active');

        $('.timeline-item .image-temp').html('');
        if (isMobile()) {
          $(this).find('.image-temp').html($('.ipl-results .ipl-results-compare').html());
        }

        $imgBox.attr('style', `--img-width:${width}px;--left-num:100%;--time-num:0s;`);
        $($imgBox)
          .find('.before-after-img-item')
          .each(function () {
            console.log(index, $(this).find('.before-after-img-box.active'));
            $(this).find('.before-after-img-box.active').addClass('close');
            $(this).find('.before-after-img-box').removeClass('active').eq(index).addClass('active');
            setTimeout(() => {
              $(this).find('.close').removeClass('close');
            }, 1000);
          });

        setTimeout(() => {
          $imgBox.attr('style', `--img-width:${width}px;--left-num:50%;--time-num:1s;`);
          initImg();
        }, 100);
      });
      window.addEventListener('resize', function () {
        if (isMobile()) {
          $('.timeline-item.active .image-temp').html($('.ipl-results .ipl-results-compare').html());
          $('.ipl-results .ipl-results-compare').hide();
        }
        initImg();
      });
      function initImg() {
        let $p = document.querySelector('.ipl-results');
        let $box = $p.querySelector('.before-after-img-wrapper');
        let $hp = $p.querySelector('.before-after-img-handle');
        let $hand = $hp.querySelector('.before-after-img-handle-btn');
        let width = $box.offsetWidth;

        $box.style = `--img-width:${width}px;--left-num:50%;`;
        makeElementDraggable($hand);
        function makeElementDraggable(draggableElement) {
          var isDragging = false;
          var offsetX = 0;

          draggableElement.addEventListener('mousedown', function (e) {
            isDragging = true;
            offsetX = e.clientX - $hp.offsetLeft;
            e.preventDefault(); // 阻止默认行为，避免文本选择
          });

          document.addEventListener('mouseup', function () {
            isDragging = false;
          });

          document.addEventListener('mousemove', function (e) {
            if (isDragging) {
              var newX = e.clientX - offsetX;
              if (newX <= 10) newX = 10;
              if (newX >= width - 10) newX = width - 10;
              $box.style = `--img-width:${width}px;--left-num:${(newX / width) * 100}%;--time-num:0s;`;
              e.preventDefault(); // 阻止默认行为，避免文本选择
            }
          });

          draggableElement.addEventListener(
            'touchstart',
            function (e) {
              isDragging = true;
              offsetX = e.touches[0].clientX - $hp.offsetLeft;
              e.preventDefault(); // 阻止默认行为
            },
            { passive: false }
          );

          document.addEventListener('touchend', function () {
            isDragging = false;
          });

          document.addEventListener(
            'touchmove',
            function (e) {
              if (isDragging) {
                e.preventDefault();
                var newX = e.touches[0].clientX - offsetX;
                if (newX <= 10) newX = 10;
                if (newX >= width - 10) newX = width - 10;
                $box.style = `--img-width:${width}px;--left-num:${(newX / width) * 100}%;--time-num:0s;`;
              }
            },
            { passive: false }
          );
        }
      }
      initImg();
    });
    function animateNumbersWhenVisible(elements) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const element = entry.target;
            const start = 0;
            const end = parseInt(element.textContent.match(/\d+/)[0]);
            const duration = Math.max(1000, Math.min(4000, Math.abs(end - start) * 20)); // 根据数字的大小调整动画时间，最小1000毫秒，最大4000毫秒
            animateNumber(element, start, end, duration);
            observer.unobserve(element); // 仅触发一次动画后停止观察
          }
        });
      });

      elements.forEach((element) => {
        observer.observe(element);
      });
    }

    function animateNumber(element, start, end, duration) {
      let startTime = null;
      const step = (timestamp) => {
        if (!startTime) startTime = timestamp;
        const progress = Math.min((timestamp - startTime) / duration, 1);
        const value = Math.floor(progress * (end - start) + start);
        element.textContent = element.textContent.replace(/\d+/, value);
        if (progress < 1) {
          requestAnimationFrame(step);
        }
      };
      requestAnimationFrame(step);
    }

    const numberContainers = document.querySelectorAll('.ipl-progress-num');
    animateNumbersWhenVisible(numberContainers); // 当元素进入可视区域时执行动画
  </script>
</section>
{% schema %}
{
  "name": "g-results-block",
  "blocks": [
    {
      "name": "item",
      "type": "item",
      "settings": [
        {
          "type": "textarea",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "textarea",
          "id": "tag",
          "label": "标签"
        },
        {
          "type": "textarea",
          "id": "subtitle",
          "label": "副标题"
        },
        {
          "type": "textarea",
          "id": "desc",
          "label": "描述"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "image_picker",
          "id": "image1",
          "label": "Image"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "页面标题"
    },
    {
      "type": "text",
      "id": "desc",
      "label": "页面描述",
      "default": "描述"
    },
    {
      "type": "text",
      "id": "text2",
      "label": "After Text"
    },
    {
      "type": "text",
      "id": "text3",
      "label": "Before Text"
    },
    {
      "type": "text",
      "id": "text4",
      "label": "底部文案",
      "default": "*The specific results vary from person to person, and the use time  can be extended according to the thickness of the hair until the desired results are achieved."
    },
    {
      "type": "text",
      "id": "text5",
      "label": "Text",
      "default": "Is IPL Right For You? Take Our Quiz."
    }
  ],
  "presets": [
    {
      "name": "g-results-block",
      "blocks": []
    }
  ]
}
{% endschema %}
