<style>
 .bothway-slide{
  padding: 120px 0;
  overflow: hidden;
}

.bothway-slide .bothway-slide-box{
  display: flex;
  align-items: center;

}
.bothway-slide .bothway-slide-txt{
  margin-right: 50px;
  width: 58.5%;
}
.bothway-slide .bothway-slide-txt .txt-img{
  display: block;
  width: 100%;
  max-height: 105px;
  object-fit: contain;
}
.bothway-slide .bothway-slide-txt .mb-box{
  display: none;
}
.bothway-slide .bothway-slide-img{
  flex: 1;
}

.bothway-slide .bothway-slide-list{
  display: flex;
  align-items: center;
}

.bothway-slide .bothway-slide-list .img{
  display: block;
  width: 14.6vw;
  margin-right: 26px;
  flex-shrink: 0;
}

.bothway-slide .flip-bothway{
  transform: scale(-1,1);
  margin-top: 26px;
}

.bothway-slide .flip-bothway .bothway-slide-txt .txt-img{
  transform: scale(-1,1);
}

@media (max-width:991px) {
   .bothway-slide{
    padding: 100px 0;
  }
  .bothway-slide .bothway-slide-txt .mb-box{
    display: block;
  }
  .bothway-slide .bothway-slide-txt .pc-box{
    display: none;
  }
  .bothway-slide .bothway-slide-txt{
    margin-right: 30px;
  }
  .bothway-slide .bothway-slide-txt{
    width:107px;
  }
  .bothway-slide .bothway-slide-list .img{
    width:100px;
    margin-right:6px;
  }
  .bothway-slide .bothway-slide-txt .txt-img{
    max-height: 15px;
  }
}
</style>

<section class="section-box">
  <div class="bothway-slide to-top">
    <div class="container">
      {%- for block in section.blocks -%}
        <div class="bothway-slide-box {% if block.settings.flip %}flip-bothway{% endif %}">
          <div class="bothway-slide-txt" >
            {%- if block.settings.image != blank -%}
              <img
                class="txt-img pc-box"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
                {% render 'image-attributes', image: block.settings.image %}
                alt="{{ block.settings.image.alt | escape }}"
              >
            {%- endif -%}
            {%- if block.settings.image1 != blank -%}
              <img
                class="txt-img mb-box"
                width="{{ block.settings.image1.width }}"
                height="{{ block.settings.image1.height }}"
                {% render 'image-attributes', image: block.settings.image1 %}
                alt="{{ block.settings.image1.alt | escape }}"
              >
            {%- endif -%}
          </div>
          <div class="bothway-slide-img" >
            <div class="bothway-slide-list">
              {%- if block.settings.image2 != blank -%}
                <img
                  class="img"
                  width="{{ block.settings.image2.width }}"
                  height="{{ block.settings.image2.height }}"
                  {% render 'image-attributes', image: block.settings.image2 %}
                  alt="{{ block.settings.image2.alt | escape }}"
                >
              {%- endif -%}
              {%- if block.settings.image3 != blank -%}
                <img
                  class="img"
                  width="{{ block.settings.image3.width }}"
                  height="{{ block.settings.image3.height }}"
                  {% render 'image-attributes', image: block.settings.image3 %}
                  alt="{{ block.settings.image3.alt | escape }}"
                >
              {%- endif -%}
              {%- if block.settings.image4 != blank -%}
                <img
                  class="img"
                  width="{{ block.settings.image4.width }}"
                  height="{{ block.settings.image4.height }}"
                  {% render 'image-attributes', image: block.settings.image4 %}
                  alt="{{ block.settings.image4.alt | escape }}"
                >
              {%- endif -%}
              {%- if block.settings.image5 != blank -%}
                <img
                  class="img"
                  width="{{ block.settings.image5.width }}"
                  height="{{ block.settings.image5.height }}"
                  {% render 'image-attributes', image: block.settings.image5 %}
                  alt="{{ block.settings.image5.alt | escape }}"
                >
              {%- endif -%}
              {%- if block.settings.image6 != blank -%}
                <img
                  class="img"
                  width="{{ block.settings.image6.width }}"
                  height="{{ block.settings.image6.height }}"
                  {% render 'image-attributes', image: block.settings.image6 %}
                  alt="{{ block.settings.image6.alt | escape }}"
                >
              {%- endif -%}
              {%- if block.settings.image7 != blank -%}
                <img
                  class="img"
                  width="{{ block.settings.image7.width }}"
                  height="{{ block.settings.image7.height }}"
                  {% render 'image-attributes', image: block.settings.image7 %}
                  alt="{{ block.settings.image7.alt | escape }}"
                >
            {%- endif -%}
            {%- if block.settings.image8 != blank -%}
              <img
                class="txt-img pc-box"
                width="{{ block.settings.image8.width }}"
                height="{{ block.settings.image8.height }}"
                {% render 'image-attributes', image: block.settings.image8 %}
                alt="{{ block.settings.image8.alt | escape }}"
              >
            {%- endif -%}
            {%- if block.settings.image9 != blank -%}
              <img
                class="txt-img pc-box"
                width="{{ block.settings.image9.width }}"
                height="{{ block.settings.image9.height }}"
                {% render 'image-attributes', image: block.settings.image9 %}
                alt="{{ block.settings.image9.alt | escape }}"
              >
            {%- endif -%}
            {%- if block.settings.image10 != blank -%}
              <img
                class="txt-img pc-box"
                width="{{ block.settings.image10.width }}"
                height="{{ block.settings.image10.height }}"
                {% render 'image-attributes', image: block.settings.image10 %}
                alt="{{ block.settings.image10.alt | escape }}"
              >
            {%- endif -%}
            {%- if block.settings.image11 != blank -%}
              <img
                class="txt-img pc-box"
                width="{{ block.settings.image11.width }}"
                height="{{ block.settings.image11.height }}"
                {% render 'image-attributes', image: block.settings.image11 %}
                alt="{{ block.settings.image11.alt | escape }}"
              >
            {%- endif -%}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>          
</section>
<script>
   window.addEventListener('load',function(){
    // function scrollSlide(){
    //   let $p= $('.bothway-slide')
    //   let $box = $p.find('.bothway-slide-img')
    //   let $cont = $p.find('.bothway-slide-box')
    //   let pWidth = $box[0].offsetWidth // 父级宽度
    //   let cWidth = ($p[0].offsetWidth - $cont[0].offsetWidth) /2 //内容区域外平分宽度
    //   let $contBox = $p.find('.container')
    //   let Aheight = $contBox[0].offsetHeight

    //   let wd1 = $('.bothway-slide-box').width()
    //   let wd2 = $('.bothway-slide-txt').width()
    //   let wdh = ( wd1 - wd2 )/ 2

    //   function changeLeft(){
    //     let wHeight = window.innerHeight
    //     $cont.each(function(){
    //       let react = $contBox[0].getBoundingClientRect()
    //       let top = react.top
    //       let length = $(this).find('.bothway-slide-list').find('.img').length
    //       let width = $(this).find('.bothway-slide-list').find('.img')[0].offsetWidth*1 + 26 //单个图片宽度
    //       let height = $(this).find('.bothway-slide-list').find('.img')[0].offsetHeight
          
    //        if(window.innerWidth<991){
    //          width -=20
    //        }
    //       let percentum = 1
    //       if(top<(wHeight/2 - Aheight/2) && top>-(wHeight - Aheight)){
    //         percentum =1- ((top +(wHeight - Aheight)) / (wHeight +(wHeight - Aheight) - Aheight))
    //         let left = (width * length - pWidth - cWidth)
    //         $(this).find('.bothway-slide-list').css({'transform': 'translateX(-'+left*percentum +'px)'})
    //         $(this).find('.bothway-slide-txt').css({'transform': 'translateX(-'+left*percentum +'px)'})
    //       }

    //       if(top<-(wHeight - Aheight)){
    //         let left = (width * length - pWidth - cWidth)
    //         $(this).find('.bothway-slide-txt').css({'transform': 'translateX(-'+left +'px)','transition': 'transform 0.1s cubic-bezier(0.4, 0.2, 0.2, 1)'})
    //         $(this).find('.bothway-slide-list').css({'transform': 'translateX(-'+left +'px)','transition': 'transform 0.1s cubic-bezier(0.4, 0.2, 0.2, 1)'})
    //       }
    //       if(top>(wHeight/2 - Aheight/2)){
    //         $(this).find('.bothway-slide-txt').css({'transform': 'translateX(+'+wdh +'px)','transition': 'transform 0.1s cubic-bezier(0.4, 0.2, 0.2, 1)'})
    //         $(this).find('.bothway-slide-list').css({'transform': 'translateX(+'+wdh +'px)','transition': 'transform 0.1s cubic-bezier(0.4, 0.2, 0.2, 1)'})
    //       }
          
    //     })
    //   }
    //   changeLeft()
    //   window.addEventListener('scroll',changeLeft)
    // }
     function scrollSlide() {
      let $p = $('.bothway-slide');
      let $box = $p.find('.bothway-slide-img');
      let $conts = $p.find('.bothway-slide-box'); // 所有 bothway-slide-box
      let pWidth = $box[0].offsetWidth; // 父级宽度
      let cWidth = ($p[0].offsetWidth - $conts[0].offsetWidth) / 2; // 内容区域外平分宽度
      let Aheight = $p.find('.container')[0].offsetHeight;
      let maxOffset = window.innerWidth*0.5; // 限制最大偏移量
      let lastOffsets = new Map(); // 记录每个 box 的偏移量
  
      function changeLeft() {
          let wHeight = window.innerHeight;
          let updated = false;
  
          $conts.each(function (index) {
              let $contBox = $(this).closest('.bothway-slide').find('.container'); // 找到对应 container
              let react = $contBox[0].getBoundingClientRect();
              let top = react.top;
              let length = $(this).find('.bothway-slide-list .img').length;
              let width = $(this).find('.bothway-slide-list .img')[0].offsetWidth + 26; // 单个图片宽度
  
              if (window.innerWidth < 991) {
                  width -= 20;
              }
  
              let left = width * length - pWidth - cWidth;
              let percentum = 1;
  
              let offset = 0;
              if (top < (wHeight / 2 - Aheight / 2) && top > -(wHeight - Aheight)) {
                  percentum = 1 - ((top + (wHeight - Aheight)) / (wHeight + (wHeight - Aheight) - Aheight));
                  offset = Math.min(left * percentum, maxOffset);
              } else if (top < -(wHeight - Aheight)) {
                  offset = left;
              } else if (top > (wHeight / 2 - Aheight / 2)) {
                  offset = 0;
              }
  
              if (lastOffsets.get(index) !== offset) {
                  $(this).find('.bothway-slide-list, .bothway-slide-txt').css({
                      'transform': `translateX(-${offset}px)`,
                      'transition': 'transform 0.3s ease-out'
                  });
                  lastOffsets.set(index, offset);
                  updated = true;
              }
          });
  
          return updated;
      }
  
      function onScroll() {
          requestAnimationFrame(changeLeft);
      }
  
      changeLeft();
      window.addEventListener('scroll', onScroll);
  }


    scrollSlide()
  })
</script>
{% schema %}
{
  "name": "bothway-slide",
  "blocks": [
    {
        "type": "item",
        "name": "item",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image1",
            "label": "Mobile Image"
          },
          {
            "type": "image_picker",
            "id": "image2",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image3",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image4",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image5",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image6",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image7",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image8",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image9",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image10",
            "label": "Image"
          },
          {
            "type": "image_picker",
            "id": "image11",
            "label": "Image"
          },
          {
            "type": "checkbox",
            "id": "flip",
            "label": "Flip",
            "default": false
          }
        ]
      }
  ],
  "presets": [
    {
      "name": "bothway-slide",
      "settings": {},
      "blocks": [
      ]
    }
  ]
}
{% endschema %}