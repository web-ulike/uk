<style>
.ipl-results{
  background: #fff;
  padding: 95px 0 108px 0;
}

.ipl-results .ipl-results-top{
  display: flex;
  justify-content: space-between;
  gap: 30px;
}

.ipl-results .ipl-results-title{
  color: #3F3636;
  font-size: 48px;
  line-height:1.2;
}

.ipl-results .ipl-results-sub{
  color: #190A0A;
  font-size: 18px;
  line-height: 1.5;
  max-width: 600px;
}

.ipl-results .ipl-results-cont{
  margin-top: 75px;
  display: flex;
  align-items: flex-end;
  gap: 80px;
}
.ipl-results .ipl-results-left{
  width: 47.78%;
}
.ipl-results .ipl-results-progress{
  display: flex;
  justify-content: space-between;
  padding:0 75px;
 }

.ipl-results .ipl-results-compare{
  flex: 1;
  display: flex;
  gap: 20px;
}

.ipl-results .ipl-progress-item:last-child{
  margin-bottom: 0;
}

.ipl-results .ipl-progress-num{
  font-size: 34px;
  line-height: 1;
  color: #E0004D;
}

.ipl-results .ipl-progress-num span{
  font-size: 70px;
}

.ipl-results .ipl-results-p{
  font-size: 16px;
  color: #190A0A;
  line-height: 1.2;
  margin-top: 14px;
}

.ipl-results .ipl-results-text{
  border-radius: 0px 0px 20px 20px;
  background: #FBFAF4;
  padding:60px 75px;
  display: flex;
  align-items: center;
  gap: 70px;
  margin-top: 120px;
}

.ipl-results .img-icon{
  width: 170px;
}

.ipl-results .ipl-results-text-p{
  color: #190A0A;
  font-size: 14px;
  line-height: 1.3;
  margin-top: 7px;
}

.ipl-results .ipl-results-text-right{
  flex: 1;
  color: #3F3636;
  font-size: 12px;
  line-height: 1.5;
}

.ipl-results .ipl-results-text-right p{
  margin:0;
}

.ipl-results .before-after-img-wrapper{
  position: relative;
  --img-width: 0px;
  --left-num: 100%;
  --time-num:1s;
  overflow: hidden;
  flex: 1;
}

.ipl-results .before-after-img-item{
  position: relative;
  z-index: 1;
  pointer-events: none;
  height: 100%;
}

.ipl-results .before-after-img-box{
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
  overflow: hidden;
}

.ipl-results .before-after-img-item .img{
  /* display: none; */
  width: 100%;
  height: 100%;
  object-fit: cover;
  user-select: none;
  pointer-events: none;
  user-drag: none;
  -moz-user-drag: none;
  -webkit-user-drag: none;
}

.ipl-results .before-after-img-item .img.active{
  display: block;
}
.ipl-results .before-after-img-box.close{
  z-index: 3;
  width: 0;
  transition: width 0.7s cubic-bezier(0.4, 0.2, 0.2, 1);
}
.ipl-results .before-after-img-box.close .img{
  height: 100%;
  width: var(--img-width);
  max-width: none;
}
.ipl-results .before-after-img-box.active{
  position: relative;
  z-index: 2;
}

.ipl-results .before-after-img-right{
  position: absolute;
  width: calc(100% - var(--left-num));
  height: 100%;
  overflow: hidden;
  z-index: 2;
  right: 0;
  top: 0;
  transition: all var(--time-num) cubic-bezier(0.645, 0.045, 0.355, 1) 0s;
}

.ipl-results .before-after-img-right .img{
  height: 100%;
  width: var(--img-width);
  max-width: none;
  position: absolute;
  right: 0;
  top: 0;
}

.ipl-results .before-after-tag{
  position: absolute;
  padding: 5px 15px;
  font-size: 14px;
  color: #fff;
  backdrop-filter: blur(16px);
  background: rgba(251, 250, 244, 0.25);
  border-radius: 20px;
  border: 1px solid #fff;
  top: 15px;
  left: 15px;
  z-index: 4;
}

.ipl-results .before-after-img-right .before-after-tag{
  left: auto;
  right: 15px;
}

.ipl-results .before-after-img-handle{
  position: absolute;
  z-index: 5;
  top: 0;
  height: 100%;
  left: var(--left-num);
  transition: all var(--time-num) cubic-bezier(0.645, 0.045, 0.355, 1) 0s;
}

.ipl-results .before-after-img-handle::before,.ipl-results .before-after-img-handle::after{
  position: absolute;
  content: '';
  display: block;
  width: 2px;
  height: calc(50% - 25px);
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
}

.ipl-results .before-after-img-handle::before{
  top: 0;
}

.ipl-results .before-after-img-handle::after{
  bottom: 0;
}

.ipl-results .before-after-img-handle-btn{
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  cursor: col-resize;
  border-radius: 50%;
  border: 2px solid #fff;
  overflow: hidden;
  width: 50px;
  height: 50px;
}

.ipl-results .before-after-img-handle-btn span{
  position: absolute;
  width: 200%;
  height: 200%;
  background: rgba(255, 255, 255, .5);
  filter: blur(10px);
  z-index: 1;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
}

.ipl-results .before-after-img-handle-btn::before,.ipl-results .before-after-img-handle-btn::after{
  position: absolute;
  content: '';
  display: block;
  border: 12px solid transparent;
  border-color: transparent #fff transparent transparent;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  z-index: 2;
}

.ipl-results .before-after-img-handle-btn::before{
  margin-left: -16px;
}

.ipl-results .before-after-img-handle-btn::after{
  transform: translate(-50%,-50%) scale(-1,-1);
  margin-left: 16px;
}

.ipl-results .ipl-results-compare-sm{
  display: flex;
  gap: 11px;
  flex-direction: column;
  width: 78px;
}

.ipl-results .ipl-results-sm-item{
  width: 100%;
  position: relative;
  cursor: pointer;
  flex: 1;
}

.ipl-results .ipl-results-sm-item::before{
  position: absolute;
  content: '';
  display: block;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 2;
  background: rgba(255, 255, 255, .5);
  opacity: 1;
  transition: opacity 0.3s cubic-bezier(0.4, 0.2, 0.2, 1);

}

.ipl-results .ipl-results-sm-item.active::before{
  opacity: 0;
}

.ipl-results .ipl-results-sm-item .img{
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: relative;
  z-index: 1;
}

.ipl-results .mb-box{
  display: none;
}

@media (max-width:1600px) {
  .ipl-results .ipl-results-text{
    padding: 40px;
    gap: 40px;
  }
  .ipl-results .ipl-results-progress{
    padding:0 40px;
 }
}

@media (max-width:1400px) {
  .ipl-results .ipl-results-cont{
    gap: 40px;
  }
  .ipl-results .ipl-progress-num{
    font-size: 28px;
  }
  .ipl-results .ipl-progress-num span{
    font-size: 50px;
  }
  .ipl-results .ipl-results-p{
    font-size: 14px;
    margin-top: 10px;
  }
  .ipl-results .ipl-results-lin{
    margin-top: 10px;
  }
  .ipl-results .ipl-results-text{
    margin-top: 70px;
  }
}

@media (max-width:991px) {
  .ipl-results{
    padding: 50px 0;
  }
  .ipl-results .pc-box{
    display: none;
  }
  .ipl-results .mb-box{
    display: block;
  }
  .ipl-results .ipl-results-top{
    flex-direction: column;
    justify-content: flex-start;
    gap: 10px;
  }
  
  .ipl-results .ipl-results-title{
    font-size: 24px;
  }
  .ipl-results .ipl-results-sub{
    font-size: 14px;
  }
  .ipl-results .ipl-results-cont{
    flex-direction: column;
    gap: 25px;
    align-items: normal;
    margin-top: 40px;
  }
  .ipl-results .ipl-results-left{
    width: 100%;
  }
  .ipl-results .ipl-progress-num{
    font-size: 14px;
  }
  .ipl-results .ipl-progress-num span{
    font-size: 34px;
  }
  .ipl-results .before-after-img-wrapper{
    width: 100%;
  }
  .ipl-results .ipl-results-compare{
    width: 100%;
    flex-direction: column;
    gap: 9px;
  }
  .ipl-results .before-after-img-handle-btn{
    width: 40px;
    height: 40px;
    border-width:1.5px;
  }
  .ipl-results .before-after-img-handle::before, .ipl-results .before-after-img-handle::after{
    height: calc(50% - 20px);
    width: 1.5px;
  }
  .ipl-results .before-after-img-handle-btn::before, .ipl-results .before-after-img-handle-btn::after{
    zoom: .7;
  }
  
  .ipl-results .ipl-results-compare-sm{
    gap: 7px;
    flex-direction: row;
    width: 100%;
  }
  .ipl-results .ipl-results-sm-item{
    width: auto;
    flex: 1;
  }
  .ipl-results .before-after-tag{
    zoom: .8;
    padding: 3px 10px;
  }

  .ipl-results .ipl-results-p{
    margin-top: 6px;
    font-size: 12px;
    line-height: 1;
  }

  .ipl-results .ipl-results-lin{
    height: 4px;
  }

  .ipl-results .ipl-progress-item{
    margin-bottom: 20px;
  }
  .ipl-results .ipl-results-progress{
      padding:0;
   }
  .ipl-results .ipl-results-text.mb-box{
    margin-top: 0;
    display: flex;
    gap: 20px;
    padding: 21px 14px;
    align-items: flex-start;
  }
  .ipl-results .ipl-results-text-right{
    zoom: 0.75;
  }

  .ipl-results .img-icon{
    width: 70px;
  }

  .ipl-results .ipl-results-text-p{
    margin-top: 3px;
    font-size: 12px;
    zoom: 0.48;
  }
}

</style>
<section class="section-box">
  <div class="ipl-results" style="background:{{ section.settings.bg_color }};">
    <div class="container">
      <div class="ipl-results-top">
        <div class="ipl-results-title to-top">{{ section.settings.title }}</div>
        <div class="ipl-results-sub to-top" style="transition-delay: 0.1s">
          {{ section.settings.text }}
        </div>
      </div>
      <div class="ipl-results-cont">
        <div class="ipl-results-left">
          <div class="ipl-results-progress">
            <div class="ipl-progress-item to-top" style="transition-delay: 0.2s">
              <div class="ipl-progress-txt">
                <div class="ipl-progress-num">{{ section.settings.text3 }}</div>
                <div class="ipl-results-p">{{ section.settings.text4 }}</div>
              </div>
            </div>
            <div class="ipl-progress-item to-top" style="transition-delay: 0.3s">
              <div class="ipl-progress-txt">
                <div class="ipl-progress-num">{{ section.settings.text5 }}</div>
                <div class="ipl-results-p">{{ section.settings.text6 }}</div>
              </div>
            </div>
            <div class="ipl-progress-item to-top" style="; transition-delay: 0.4s">
              <div class="ipl-progress-txt">
                <div class="ipl-progress-num">{{ section.settings.text7 }}</div>
                <div class="ipl-results-p">{{ section.settings.text8 }}</div>
              </div>
            </div>
          </div>
          <div class="ipl-results-text to-top pc-box" style="transition-delay: 0.5s">
            <div class="ipl-results-text-left">
              {%- if section.settings.image != blank -%}
                 <img loading="lazy" class="img-icon" width="{{ section.settings.image.width }}" height="{{ section.settings.image.height }}" {% render 'image-attributes', image: section.settings.image %} alt="{{ section.settings.image.alt | escape }}" >
              {%- endif -%}
              <div class="ipl-results-text-p">{{ section.settings.text9 }}</div>
            </div>
            <div class="ipl-results-text-right">
              {{ section.settings.text10 }}
            </div>
          </div>
        </div>
        <div class="ipl-results-compare">
          <div class="before-after-img-wrapper to-top" style="transition-delay: 0.2s">
            <div class="before-after-img-item">
              {%- for block in section.blocks -%}
                <div class="before-after-img-box {% if forloop.index == 1 %}active{% endif %}">
                  {%- if block.settings.image1 != blank -%}
                     <img loading="lazy" class="img" width="{{ block.settings.image1.width }}" height="{{ block.settings.image1.height }}" {% render 'image-attributes', image: block.settings.image1 %} alt="{{ block.settings.image1.alt | escape }}" >
                  {%- endif -%}
                </div>
              {%- endfor -%}
              {%- if section.settings.text1 != blank -%}
                <div class="before-after-tag">{{ section.settings.text1 }}</div>
              {%- endif -%}
            </div>
            <div class="before-after-img-item before-after-img-right">
              {%- for block in section.blocks -%}
                <div class="before-after-img-box {% if forloop.index == 1 %}active{% endif %}">
                  {%- if block.settings.image2 != blank -%}
                     <img loading="lazy" class="img" width="{{ block.settings.image2.width }}" height="{{ block.settings.image2.height }}" {% render 'image-attributes', image: block.settings.image2 %} alt="{{ block.settings.image2.alt | escape }}" >
                  {%- endif -%}
                </div>
              {%- endfor -%}
              {%- if section.settings.text2 != blank -%}
                <div class="before-after-tag">{{ section.settings.text2 }}</div>
              {%- endif -%}
            </div>
            <div class="before-after-img-handle">
              <div class="before-after-img-handle-btn">
                <span></span>
              </div>
            </div>
          </div>
          <div class="ipl-results-compare-sm to-top" style="transition-delay: 0.3s" >
            {%- for block in section.blocks -%}
              <div class="ipl-results-sm-item {% if forloop.index == 1 %}active{% endif %}">
                {%- if block.settings.image != blank -%}
                   <img loading="lazy" class="img" width="{{ block.settings.image.width }}" height="{{ block.settings.image.height }}" {% render 'image-attributes', image: block.settings.image %} alt="{{ block.settings.image.alt | escape }}" >
                {%- endif -%}
              </div>
            {%- endfor -%}
          </div>
        </div>
        <div class="ipl-results-text mb-box to-top" style="transition-delay: 0.5s">
          <div class="ipl-results-text-left">
            {%- if section.settings.image != blank -%}
               <img loading="lazy" class="img-icon" width="{{ section.settings.image.width }}" height="{{ section.settings.image.height }}" {% render 'image-attributes', image: section.settings.image %} alt="{{ section.settings.image.alt | escape }}" >
            {%- endif -%}
            <div class="ipl-results-text-p">{{ section.settings.text9 }}</div>
          </div>
          <div class="ipl-results-text-right">
            {{ section.settings.text10 }}
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>

    function wrapStringsWithSpan(element) {
      let text = element.innerText;
      let parts = text.split(/(\.|\%)/);
      let html = "";
      let isPoint = parts.includes('.')
      let dotFound = false;
      let isFirst = true
      for (let i = 0; i < parts.length; i++) {
          if(parts[i] !==''){
              if (parts[i] === ".") {
                  dotFound = true;
                  html += "</span>" + parts[i];
              } else if (parts[i] === "%" && dotFound||parts[i] === "%" && !isPoint) {
                  if(!isPoint){
                      html += "</span>" + parts[i]
                  }else{
                      html += parts[i]
                      dotFound = false;
                  }
              } else {
                  if(isFirst) {
                      html+= "<span>" + parts[i];
                      isFirst = false
                  }else{
                      html += parts[i];
                  }
              }
          }
      }
      element.innerHTML = html;
  }
  document.querySelectorAll('.ipl-progress-num').forEach(ele=>{
    wrapStringsWithSpan(ele)
  })
    
    window.addEventListener('load', function () {
      $('.ipl-results .ipl-results-sm-item').click(function () {
        let index = $(this).index()
        let $imgBox = $(this)
          .parents('.ipl-results-compare-sm')
          .siblings('.before-after-img-wrapper')
        let width = $imgBox[0].offsetWidth
        $imgBox.attr(
          'style',
          `--img-width:${width}px;--left-num:100%;--time-num:0s;`
        )
        $(this).addClass('active').siblings().removeClass('active')
        $(this).parents('.ipl-results-compare-sm').siblings('.before-after-img-wrapper').find('.before-after-img-item').each(function () {
            $(this).find('.before-after-img-box.active').addClass('close')
            $(this).find('.before-after-img-box').removeClass('active').eq(index).addClass('active')
            setTimeout(()=>{
              $(this).find('.close').removeClass('close')
            },1000)
          })
        setTimeout(() => {
          $imgBox.attr(
            'style',
            `--img-width:${width}px;--left-num:50%;--time-num:1s;`
          )
        }, 100)
      })
      window.addEventListener('resize', function () {
        initImg()
      })
      function initImg() {
        let $p = document.querySelector('.ipl-results')
        let $box = $p.querySelector('.before-after-img-wrapper')
        let $hp = $p.querySelector('.before-after-img-handle')
        let $hand = $hp.querySelector('.before-after-img-handle-btn')
        let width = $box.offsetWidth

        $box.style = `--img-width:${width}px;--left-num:50%;`
        makeElementDraggable($hand)
        function makeElementDraggable(draggableElement) {
          var isDragging = false
          var offsetX = 0

          draggableElement.addEventListener('mousedown', function (e) {
            isDragging = true
            offsetX = e.clientX - $hp.offsetLeft
            e.preventDefault() // 阻止默认行为，避免文本选择
          })

          document.addEventListener('mouseup', function () {
            isDragging = false
          })

          document.addEventListener('mousemove', function (e) {
            if (isDragging) {
              var newX = e.clientX - offsetX
              if (newX <= 10) newX = 10
              if (newX >= width - 10) newX = width - 10
              $box.style = `--img-width:${width}px;--left-num:${
                (newX / width) * 100
              }%;--time-num:0s;`
              e.preventDefault() // 阻止默认行为，避免文本选择
            }
          })

          draggableElement.addEventListener(
            'touchstart',
            function (e) {
              isDragging = true
              offsetX = e.touches[0].clientX - $hp.offsetLeft
              e.preventDefault() // 阻止默认行为
            },
            { passive: false }
          )

          document.addEventListener('touchend', function () {
            isDragging = false
          })

          document.addEventListener(
            'touchmove',
            function (e) {
              if (isDragging) {
                e.preventDefault()
                var newX = e.touches[0].clientX - offsetX
                if (newX <= 10) newX = 10
                if (newX >= width - 10) newX = width - 10
                $box.style = `--img-width:${width}px;--left-num:${
                  (newX / width) * 100
                }%;--time-num:0s;`
              }
            },
            { passive: false }
          )
        }
      }
      initImg()
      animateNumbersVisibleAnime('.ipl-progress-num span');
    })

  </script>
</section>
{% schema %}
{
"name": "comparison-results",
"blocks": [
    {
    "name": "item",
    "type": "item",
    "settings": [
      {
        "type": "image_picker",
        "id": "image",
        "label": "Image"
      },
      {
        "type": "image_picker",
        "id": "image1",
        "label": "Image"
      },
      {
        "type": "image_picker",
        "id": "image2",
        "label": "Image"
      }
    ]
    }
  ],
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#f9f9f9"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "text",
      "id": "text",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text1",
      "label": "Before Text"
    },
    {
      "type": "text",
      "id": "text2",
      "label": "After Text"
    },
    {
      "type": "text",
      "id": "text3",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text4",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text5",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text6",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text7",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "text8",
      "label": "Text"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "text9",
      "label": "Text"
    },
    {
      "type": "richtext",
      "id": "text10",
      "label": "Text"
    }
  ],
  "presets": [
    {
      "name": "comparison-results",
      "blocks": []
    }
  ]
}
{% endschema %}